import { ArrowDown, Filter, Search } from '@element-plus/icons-vue';
import { resolveComponent, openBlock, createBlock, withCtx, withDirectives, createElementVNode, createVNode, vShow, createTextVNode, defineComponent, defineAsyncComponent, useCssVars, resolveDirective, createElementBlock, Fragment, renderSlot, createCommentVNode, normalizeClass, renderList, toDisplayString, withModifiers, normalizeStyle, pushScopeId, popScopeId, h, ref, inject, nextTick } from 'vue';
import { ElMessage } from 'element-plus';
import { format } from 'date-fns';
import lodash from 'lodash';

// 行状态
const UNCHANGED = 'Unchanged';
const MODIFIED = 'Modified';
const ADDED = 'Added';

// 一下这些是这个Vol.Vue中的工具函数
const checkUrl = (url) => {
  // url= 协议://(ftp的登录信息)[IP|域名](:端口号)(/或?请求参数)
  var strRegex =
    '^((https|http|ftp)://)?' + // (https或http或ftp):// 可有可无
    "(([\\w_!~*'()\\.&=+$%-]+: )?[\\w_!~*'()\\.&=+$%-]+@)?" + // ftp的user@  可有可无
    '(([0-9]{1,3}\\.){3}[0-9]{1,3}' + // IP形式的URL- 3位数字.3位数字.3位数字.3位数字
    '|' + // 允许IP和DOMAIN（域名）
    '(localhost)|' + // 匹配localhost
    "([\\w_!~*'()-]+\\.)*" + // 域名- 至少一个[英文或数字_!~*\'()-]加上.
    '\\w+\\.' + // 一级域名 -英文或数字  加上.
    '[a-zA-Z]{1,6})' + // 顶级域名- 1-6位英文
    '(:[0-9]{1,5})?' + // 端口- :80 ,1-5位数字
    '((/?)|' + // url无参数结尾 - 斜杆或这没有
    "(/[\\w_!~*'()\\.;?:@&=+$,%#-]+)+/?)$"; // 请求参数结尾- 英文或数字和[]内的各种字符
  var re = new RegExp(strRegex, 'i'); // i不区分大小写
  // 将url做uri转码后再匹配，解除请求参数中的中文和空字符影响
  if (re.test(encodeURI(url))) {
    return true
  }
  return false
};

const previewImg = (src, httpUrl) => { // 图片预览，目前只支持单图片预览
  if (src && !checkUrl(src) && httpUrl) {
    if (src.substr(0, 1) == '/' && httpUrl.substr(httpUrl.length - 1, 1) == '/') {
      src = src.substr(1);
    }
    src = (httpUrl + src);
  }
  let id = 'vol-preview';
  let $div = document.getElementById(id);
  if (!$div) {
    $div = document.createElement('div');
    $div.setAttribute('id', 'vol-preview');
    let $mask = document.createElement('div');
    $mask.style.position = 'absolute';
    $mask.style.width = '100%';
    $mask.style.height = '100%';
    $mask.style.background = 'black';
    $mask.style.opacity = '0.6';
    $div.appendChild($mask);
    $div.style.position = 'fixed';
    $div.style.width = '100%';
    $div.style.height = '100%';
    // $div.style.overflow = "scroll";
    $div.style.top = 0;
    $div.style['z-index'] = 9999999;
    let $img = document.createElement('img');
    $img.setAttribute('class', 'vol-preview-img');
    $img.style.position = 'absolute';
    $img.style.top = '50%';
    $img.style.left = '50%';
    $img.style['max-width'] = '90%';
    $img.style['max-height'] = '90%';
    $img.style.transform = 'translate(-50%,-50%)';
    // $img.src = src;
    $img.setAttribute('src', src);
    $div.appendChild($img);
    $div.addEventListener('click', function () {
      this.style.display = 'none';
    });
    document.body.appendChild($div);
    return
  }
  let $img1 = document.body.appendChild($div).querySelector('.vol-preview-img');
  // img.src = src;
  $img1.setAttribute('src', src);
  $div.style.display = 'block';
};

function isVoid(value) {
  return value === undefined || value === null || value === ''
}

// 防抖  flag->第一次是否执行
const debounce = (event, time = 300, flag) => {
  let timer = null;
  return function (...args) {
    clearTimeout(timer);
    if (flag && !timer) {
      event.apply(this, args);
    }
    timer = setTimeout(() => {
      event.apply(this, args);
    }, time);
  };
};

// rgb(122, 133, 144) -> rgba(122, 133, 144, .1)
const RgbToRgba = (color, opactiy = 0.1) =>
  color.replace(/(^rgb)\((.+)\)/g, `$1a($2, ${opactiy})`);

const tableFilterMixin = {
  data() {
    return {
      rowDataCopy: [],
      fields: [] // 列名组
    };
  },
  created() {
    this.getFields();
  },
  methods: {
    setRowDataCopy(data) {
      this.rowDataCopy = lodash.cloneDeep(data);
    },
    getFields() {
      this.fields = this.filterColumns.map(item => {
        return item.field;
      });
    },
    showData(row, column, val = null) {
      let textInput = this.$refs.tableFilterRef?.textInput.trim();
      if (typeof textInput === 'undefined') return val;
      let text = lodash.toString(val || row[column.field]);
      // type  text:string type
      if (typeof text === 'undefined' || text === 'undefined') return;
      if (textInput == '') {
        if (column.dropDownInput != '' && text.includes(column.dropDownInput)) {
          text = text.replace(
            column.dropDownInput.trim(),
            '<span class="keyword-lighten" style="color: #000;background-color: #ffff00;">' + column.dropDownInput.trim() + '</span>'
          );
        }
        return text;
      } else {
        if (text && text.includes(textInput)) {
          text = text.replace(textInput, '<span class="keyword-lighten" style="color: #000;background-color: #ffff00;">' + textInput + '</span>');
        }
        return text;
      }
    },
    // 改变查找面板菜单文字
    changeTableFilterLabel(isShow) {
      let tableFilterIndex = this.basicCtxMenu.columnMenu.findIndex(
        item => item.label === '显示查找面板' || item.label === '隐藏查找面板'
      );
      if (isShow) {
        this.basicCtxMenu.columnMenu[tableFilterIndex]['label'] = '隐藏查找面板';
      } else {
        this.basicCtxMenu.columnMenu[tableFilterIndex]['label'] = '显示查找面板';
      }
    },
    filterInputKeyUp(newValue) {
      debounce(() => {
        if (newValue == '' && newValue.length == 0) {
          this.rowData.splice(0, this.rowData.length, ...this.rowDataCopy);
        } else {
          let res = this.rowDataCopy.filter(item => {
            return this.fields.some(key => {
              const reg = new RegExp(newValue, 'i');
              return lodash.toString(item[key]).match(reg);
            });
          });
          this.rowData.splice(0, this.rowData.length, ...res);
        }
      }, 100)();
    },
    isRealNum(val) {
      if (typeof val !== 'number') {
        return false;
      }
      if (!isNaN(val)) {
        return true;
      } else {
        return false;
      }
    },
    formatterFilter(val, row, column) {
      // let val = row[column.field];
      if (val === null || val === undefined) {
        return val;
      }
      if (this.isRealNum(val)) {
        val = val.toString();
      }
      return this.showData(row, column, val);
    },

    formatter(row, column, template) {
      if (!template) return this.formatterFilter(row[column.property], row, column);
      let val = row[column.field];
      // 是否值
      if (column.edit && column.edit.type == 'switch') {
        return val
          ? this.formatterFilter('是', row, column)
          : this.formatterFilter('否', row, column);
      }
      if (!column.bind || !column.bind.data) {
        return this.formatterFilter(row[column.field], row, column);
      }
      if (!val && val != 0) return this.formatterFilter(val, row, column);
      // 编辑多选table显示
      if (
        (column.bind.type == 'selectList' || column.bind.type == 'checkbox') &&
        typeof val === 'string' &&
        val.indexOf(',') != -1
      ) {
        return this.formatterFilter(this.getSelectFormatter(column, val), row, column);
      }
      let source = column.bind.data.find(x => {
        // return x.key != "" && x.key == val;
        // 2020.06.06修复单独使用table组件时,key为数字0时转换成文本失败的问题
        return x.key !== '' && x.key !== undefined && x.key + '' === val + '';
      });
      if (source) {
        val = source.value;
      }

      // if (column.dropDownInput !== '' && val.indexOf(column.dropDownInput.trim()) !== -1 && column.dropDownInput !== '') {
      //   val = val.replace(column.dropDownInput.trim(), '<span class="keyword-lighten">' + column.dropDownInput.trim() + "</span>");
      // } else {
      //     return val;
      // }
      return this.formatterFilter(val, row, column);
    },
    // 显示查找面板
    showTableFilter() {
      this.$refs.tableFilterRef.show();
    }
  }
};

/**
 * 右键扩展菜单
 * author kai
 */

// import { ConsoleLogger } from "@microsoft/signalr/dist/esm/Utils";

const contextMenuMixin = {
  data() {
    return {
      contextMenu: {
        key: '',
        list: []
      },
      // 默认菜单
      basicCtxMenu: {
        columnMenu: [
          {
            label: '栏目设置',
            click: this.columnSetup
          },
          {
            label: '显示查找面板',
            click: this.showTableFilter
          },
          {
            label: '功能设计',
            click: this.goDesignPage
          },
          {
            label: '表格列设计',
            click: this.designTableColumns
          }
        ],
        rowMenu: [
          {
            label: '复制文本',
            click: this.copyText
          },
          {
            label: '导出',
            click: this.exportFun
          },
          // {
          //   label: '字段批量替代',
          //   click: this.batchReplace
          // }
        ]
      }
    };
  },
  methods: {
    
    exportFun() {
      this.$emit('ctxMenuExport');
    },
    copyText({ event }) {
      let input = document.querySelector('#copy-input');
      if (!input) {
        input = document.createElement('input');
        input.setAttribute('id', 'copy-input');
        input.style.position = 'fixed';
        input.style.top = '5000px';
        input.style.left = '5000px';
        document.body.appendChild(input);
      }
      input.value = event.target.innerText;
      input.select();
      document.execCommand('copy');
    },
    // columnMenu rowMenu
    openContextMenu(key, row, column, event) {
      let x = 0,
        y = 0,
        data = null;
      if (key == 'columnMenu') {
        column.preventDefault();
        x = column.clientX;
        y = column.clientY;
        data = {
          key,
          column: row,
          event: column
        };
      } else {
        event.preventDefault();
        x = event.clientX;
        y = event.clientY;
        data = {
          key,
          row,
          column,
          event
        };
      }
      if (this.contextMenu.key !== key) {
        this.contextMenu.key = key;
        this.contextMenu.list.splice(0, this.contextMenu.list.length, ...this.basicCtxMenu[key]);
        // 扩展菜单
        if (this.ctxMenu && this.ctxMenu[key] && this.ctxMenu[key].length) {
          this.contextMenu.list.push(...this.ctxMenu[key]);
        }
      }
      if (this.contextMenu.list.length) {
        this.$refs.ctxMenuRef.show(x, y, data);
      }
    },
    columnSetup(data) {
      this.openColumnSetUp(data);
    },
    // 行 字段批量替代
    batchReplace(...regs) {
      console.log(regs);
    },
    // 跳转设计界面
    goDesignPage() {
      this.$router.push(`/CodeDesign?tableName=${this.tableName}`);
    },
    designTableColumns() {
      this.$refs.designColRef.show();
    },

  },
};

/**
 * formatDecimal 补充小数
 * value 字段对应值
 * length 小数长度
 */
function formatDecimal(value, length) {
  let result = '';
  let strNum = value ? String(value) : '0';
  // 整数
  if (!strNum.includes('.')) {
    result = `${strNum}.${'0'.repeat(length)}`;
  } else {
    // 小数
    let strArr = strNum.split('.');
    // 1. 大于长度
    if (strArr[1].length > length) {
      result = Number(strNum).toFixed(length);
      // 等于
    } else if (strArr[1].length === length) {
      result = Number(strNum);
    } else {
      // 小于
      let repeatNum = length - strArr[1].length;
      strArr[1] = strArr[1] + '0'.repeat(repeatNum);
      result = strArr.join('.');
    }
  }
  return result;
}


function getDecimalNum(value, field) {
  if (isNaN(value)) return value;
  // 小数位-> 4 2 6 4 2 5
  let { iRoundQty, iRoundUnitPrice, iRoundPersent, iRoundAmout, iRoundNum, iRoundInvRate } = {
    iRoundAmout:"2",
  iRoundInvRate:"6",
  iRoundNorQty:"3",
  iRoundNum:"2",
  iRoundPersent:"6",
  iRoundQty:"4",
  iRoundUnitPrice:"2"
  };

  let num = 0;
  switch (field) {
    case 'iQuantity': // 数量
    case 'iReqQty': // 订货数量
    case 'iFHQuantity': // 发货数量
    case 'fOutquantity': // 出库数量
    case 'iFHQuantity':
      num = formatDecimal(value, iRoundQty);
      break;
    case 'iNum': // 辅助数量
      num = formatDecimal(value, iRoundNum);
      break;
    case 'iUnitPrice': // 无税单价
    case 'iTaxUnitPrice': // 单价
    case 'iQuotedPrice': // 报价
    case 'KL': // 扣率
      num = formatDecimal(value, iRoundUnitPrice);
      break;
    case 'iTaxRate':// 税率
    case 'iExchRate':
    case 'iReplaceQtyPer': //替换比例
      num = formatDecimal(value, iRoundPersent);
      break;
    case 'iMoney': // 无税金额
    case 'iTax': // 税额
    case 'iSum': // 价税合计
    case 'iDiscount': // 折扣金额
      num = formatDecimal(value, iRoundAmout);
      break;
    case 'iInvExchRate': // 换算率
      num = formatDecimal(value, iRoundInvRate);
      break;
    default:
      num = value;
      break;
  }
  return num;
}

/**
 * 数字原始值与四舍五入值切换
 * 日期格式化 yyyy-MM-dd HH:mm:ss -> yyyy-MM-dd
 * author kai
 */

const tableNumFormatMixin = {
  data() {
    return {
      // 存每行数字的值 原始值(original) 四舍五入(round) focus->original blur->round
      originalRoundNum: {
        // 'iNum-1': { origin: 101.1234567, round: '101.1235' }
      },
      execRound: true, // 当没有输入输入物料编码 失去焦点时 重新赋值为第一次的值
      curColumn: null
    };
  },
  methods: {
    clearOriginial() {
      for (const key in this.originalRoundNum) {
        if (this.originalRoundNum.hasOwnProperty(key)) {
          delete this.originalRoundNum[key];
        }
      }
    },
    getFormatNum(value, field) {
      return getDecimalNum(value, field)
    },
    // table查看界面 数字格式化
    formatNumber(row, column, index) {
      if (index < 0) return ''
      // let _numTemp = this.getOriginRoundNum(column.field, index)
      // _numTemp['original'] = row[column.field] === null ? 0 : Number(String(row[column.field]));
      let roundNum = this.getFormatNum(row[column.field], column.field);
      // _numTemp['round'] = roundNum;
      // row[column.field] = roundNum
      return roundNum;
    },
    // 
    delOriginRoundNum(index) {
      if (!this.curColumn) return;
      let { field } = this.curColumn;
      let key = `${field}-${index}`;
      delete this.originalRoundNum[key];
      // console.log(field, index, key);
      // console.log(JSON.stringify(this.originalRoundNum));
      // console.log(this.originalRoundNum);
    },
    getOriginRoundNum(field, index, original) {
      let _numTemp = this.originalRoundNum[`${field}-${index}`];
      if (!_numTemp) {
        _numTemp = {
          original,
          round: ''
        };
        this.originalRoundNum[`${field}-${index}`] = _numTemp;
      }
      // console.log(this.originalRoundNum);
      return _numTemp
    },
    // 数字输入框 失去焦点 为数量添加小数
    roundNum(row, column, index) {
      if (!this.execRound) {
        this.execRound = true;
      }

      let field = column.field;
      let _numTemp = this.getOriginRoundNum(field, index);
      this.itemChanged(row, column, (status = true) => {
        console.log(status);
        this.execRound = status;
      });
      // console.log(this.execRound);
      // console.log(_numTemp);
      if (!this.execRound) {
        row[field] = _numTemp.original;
        return
      }

      _numTemp['original'] = row[field];
      let num = this.getFormatNum(row[column.field], column.field);
      row[field] = num;

      _numTemp['round'] = num;

      if (!row.rowState || row.rowState === UNCHANGED) {
        this.setRowState(row, column);
      }

    },
    // 数字输入框 获取焦点 原始值
    originalNum(row, column, index) {
      this.curColumn = column;
      let field = column.field;
      let _numTemp = this.getOriginRoundNum(field, index, row[field]);
      if (_numTemp) {
        row[field] = _numTemp['original'];
      }
      this.setCopyRow(row, true);
    }
  }
};

var errorPng = "data:image/png;base64,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";

var TableFilter_vue_vue_type_style_index_0_scoped_true_lang = '';

var _export_sfc = (sfc, props) => {
  const target = sfc.__vccOpts || sfc;
  for (const [key, val] of props) {
    target[key] = val;
  }
  return target;
};

const _sfc_main$2 = {
  data() {
    return {
      isShowTableFilter: false, // 是否打开表格过滤
      textInput: '' // 过滤文字
    };
  },
  methods: {
    onInput() {
      // debounce(() => {
      this.$emit('filterInputKeyUp', this.textInput);
      // }, 1000)();
    },
    // 关闭表格过滤
    closeTableFilter() {
      this.isShowTableFilter = false;
      this.$emit('isShowTableFilter', false);
    },
    // 切换展示
    show() {
      this.isShowTableFilter = !this.isShowTableFilter;
      this.$emit('isShowTableFilter', this.isShowTableFilter);
    },
    // 清除过滤
    clearInput() {
      this.textInput = '';
      this.onInput();
    }
  }
};
const _hoisted_1$2 = { id: "table-filter" };
const _hoisted_2$1 = /*#__PURE__*/createTextVNode("清除");
const _hoisted_3$1 = /*#__PURE__*/createTextVNode("关闭");

function _sfc_render$1(_ctx, _cache, $props, $setup, $data, $options) {
  const _component_el_input = resolveComponent("el-input");
  const _component_el_button = resolveComponent("el-button");
  const _component_el_collapse_transition = resolveComponent("el-collapse-transition");

  return (openBlock(), createBlock(_component_el_collapse_transition, null, {
    default: withCtx(() => [
      withDirectives(createElementVNode("div", _hoisted_1$2, [
        createVNode(_component_el_input, {
          class: "text-input",
          modelValue: $data.textInput,
          "onUpdate:modelValue": _cache[0] || (_cache[0] = $event => (($data.textInput) = $event)),
          placeholder: "请输入内容",
          onInput: $options.onInput
        }, null, 8, ["modelValue", "onInput"]),
        createVNode(_component_el_button, {
          onClick: $options.clearInput,
          size: "small",
          plain: ""
        }, {
          default: withCtx(() => [
            _hoisted_2$1
          ]),
          _: 1
        }, 8, ["onClick"]),
        createVNode(_component_el_button, {
          onClick: $options.closeTableFilter,
          size: "small",
          plan: ""
        }, {
          default: withCtx(() => [
            _hoisted_3$1
          ]),
          _: 1
        }, 8, ["onClick"])
      ], 512), [
        [vShow, $data.isShowTableFilter]
      ])
    ]),
    _: 1
  }))
}
var TableFilter = /*#__PURE__*/_export_sfc(_sfc_main$2, [['render',_sfc_render$1],['__scopeId',"data-v-6eaa10dd"]]);

var VolTable_vue_vue_type_style_index_0_scoped_true_lang = '';

// rowdbClick 阻止 rowClick 
let time = 120, //200,  单击间隔时间减少 2022-07-15 JonasCheng
  timer = null;
const __default__ = defineComponent({
  name: 'VolTable',
  mixins: [
    tableFilterMixin,
    contextMenuMixin,
    tableNumFormatMixin,
  ],
  inject: ['gridInstance', 'loadCompData'],
  emits: [
    'loadBefore',
    'loadAfter',
    'rowClick',
    'rowDbClick',
    'paginationsChange',
    'linkEdit',
    'addAttachment',
    'deleteAttachment',
    'downloadAttachment',
    'openBaseInfo',
    'dItemChanged'
  ],
  components: {
    ArrowDown,
    FilterIcon: Filter,
    TableRender: defineAsyncComponent(() => Promise.resolve().then(function () { return VolTableRender$1; })),
    ContextMenu: defineAsyncComponent(() =>
      Promise.resolve().then(function () { return ContextMenu$1; })
    ),
    // TableFilter: defineAsyncComponent(() => import('./TableFilter.vue')),
    TableFilter, 
    // DesignTableColumn: defineAsyncComponent(() =>
    //   import('@/components/CodeDesign/comps/DesignTableColumn.vue')
    // )
  },
  props: {
    height: [Number, String],
    // 合计
    showSummary: {
      type: Boolean,
      default: false
    },
    // 查询数据 排序字段
    sortField: {
      type: String,
      default: ''
    },
    //排序方式 asc desc
    sortOrder:{
      type: String,
      default: ''
    },
    // 右键菜单查找面板 显示与否
    showFilterSearch: {
      type: Boolean,
      default: true
    },
    // 右键菜单
    showCtxMenu: {
      type: Boolean,
      default: true
    },
    // 2021-12-07 kai 增加主键字段 用于选中 删除选中行(没有找到el-table选中行的数据集合 selection为undefined)
    primaryKey: {
      type: String,
      required: true
    },
    keyCode: {
      type: String,
      default: ''
    },
    // 右键菜单
    ctxMenu: {
      type: Object,
      default: () => ({})
    },
    storeName: {
      type: String,
      default: ''
    },    
    tableData: {
      // 表数据源,配置了url就不用传这个参数了
      type: Array,
      default: () => []
    },
    // 明细新增传了url又需要传数据 默认让他undefined
    customRowData: Array,
    // 编辑模式
    editType: {
      type: Boolean,
      default: false
    },
    columns: {
      type: Array,
      default: () => []
    },
    // 请求路径
    url: {
      type: String,
      default: ''
    },
    tableName: {
      type: String,
      default: ''
    },
    tableCNName: {
      type: String,
      default: ''
    },
    // 隐藏分页
    paginationHide: {
      type: Boolean,
      default: false
    },
    // 刷新table
    defaultLoadPage: {
      type: Boolean,
      default: true
    },
    // 是否自动从后台加载数据源,如【审核状态】字段是的值是数字，但要显示对应的文字，1=审核中，2=审核通过
    loadKey: {
      type: Boolean,
      default: true
    },
    // 是否双击启用编辑功能
    doubleEdit: {
      type: Boolean,
      default: false
    },
    // 是否点击行编辑，再次点击行时结束编辑(默认点击行编辑，鼠标离开结束编辑)
    clickEdit: {
      type: Boolean,
      default: false
    },
    // 是否显示选择框
    colSelection: {
      type: Boolean,
      default: true
    },
    // 是否显示索引
    colIndex: {
      type: Boolean,
      default: true
    },
    // 选择框固定
    ckFixed: {
      type: Boolean,
      default: false
    },
    // 索引固定
    indexFixed: {
      type: Boolean,
      default: false
    },
    attachmentCount: {
      type: Array,
      default: () => [] //{ code: 'SD2111080001', key: 'iInterID', value: 391, count: 1 } 存储有附件行的主要信息
    },
    openColumnSetUp: {
      type: Array,
      default: () => {}
    },
    // 2022-04-21 kai 这什么东西我也不晓得，乱搞，搞这些代码如同愚公移山
    tableid: {
      type: String,
      default: ''
    }
  },
  data() {
    return {
      // 表头排序图标是否显示
      sortable: false,
      ArrowDown,
      SearchIcon: Search,
      // DesignTableColumn: null, // DesignTableColumn.vue 组件
      complete: {},
      selection: [], // table 选中行
      errorPng,
      loading: false,
      rowData: [],//当前展示的数据
      
      paginations: {
        sort: this.sortField,
        order: this.sortOrder||'desc',
        sizes: [100, 500, 1000, 5000, 10000, 20000, 50000],
        size: 100, //500, // 默认分页大小
        page: 1,
        total: 0
      },
      edit: { columnIndex: -1, rowIndex: -1 }, // 当前双击编辑的行与列坐标
      remoteColumns: [], // 需要每次刷新或分页后从后台加载字典数据源的列配置
      cellStyleColumns: {}, // 有背景颜色的配置
      copyCurRow: ' ', // 点击 focus 行数据
      curRow: null, // 点击行
      filterData: {
        visible: false,
        filterValus: [], //已经筛选的值
        checkFilterVals: [],//一共选择筛选的值
        type: '',//筛选的值的类型
        binds: [],
        filterKey: '',//筛选框输入的值
        column: null //筛选的列
      },
      fPosition: {
        x: 0,
        y: 0
      }
    };
  },
  created() {
    this.defaultLoadPage && this.load();
  },
  mounted() {
    this.getSelectKeyValue();
    const formTable = document.getElementsByClassName('form-table')[0];
    const splitArea = document.getElementsByClassName('pagination-wrapper')[0];
    try {
      this.initDrag(formTable,splitArea);
    } catch (error) {
      return
    }
  },
  watch: {
    customRowData(data) {
      if (data) {
        this.rowData = data;
      }
    },
    // 明细mounted时没有columns 在此执行一次(主表并没有再次出发)
    columns(cols) {
      // console.log(cols);
      this.getSelectKeyValue();
    }
  },
  computed: {
    filterColumns() {
      return this.columns;
    },
    getFLabel() {
      return function (v) {
        let binds = this.filterData.binds;
        if (binds.length) {
          let res = binds.find(b => b.key === v);
          return res?.value || v;
        } else {
          return v;
        }
      };
    },
    getFilterStyle() {
      // 2022-08-09 kai 字段值晒寻面板位置调整(完全显示，不遮挡)
      // document.body.height body高度
      let docBodyH=document.body.clientHeight;
      // 筛选面板高度
      let filterPanH = 0;
      if(this.$refs.filterRef){
        filterPanH = this.$refs.filterRef.offsetHeight;
      }
      let { x, y } = this.fPosition;
      // 如果点击位置的高度加上面板的高度大于body的高度 则使用body的高度减去面板高度与15 否则就是点击时高度
      let resY = y + filterPanH > docBodyH ? docBodyH - filterPanH - 15 : y;

      return { transform: `translate(${x}px, ${resY}px)` };
    },
    tableRowBg() {
      // return RgbToRgba(this.$store.getters.getThemeColor, 0.2);
      return RgbToRgba("#409eff", 0.2);
    }
  },
  methods: {
    // 双击表头单元格时触发
    headerSort({ column }) {
      // 双击表头单元格显示排序图标，并且自动开启正序排序
      // 再次双击取消图标，取消排序恢复默认状态
      // FIXME：显示图标时没有自动打开排序
      column.sortable = !column.sortable;
      // console.log('当前列', column)
      // console.log('table对象', this.$refs.table)
      if (column.sortable) {
        // 双击时没有升序是这里有问题，待解决
        this.$refs.table.sort(column.field, 'asc');
      }
      this.$refs.table.sort(column.field, null);
    },
    //多字段排序
    sortChangeEvent({sortList }) {
      console.info(sortList.map((item) => `${item.property},${item.order}`).join('; '));
    },

    //这个函数用于增加用户点击范围
    changeChildValue(row,column){
      if(typeof column.edit.disabled=='function'&&!(column.edit.disabled(row))){
      // 2022-08-05 kai 只要触发change事件 就改变行状态
      if(row[column.field]==1){ 
        row[column.field]=0;
      }else {
        row[column.field]=1;
      }
      if (!row.rowState||row.rowState === UNCHANGED) {
        row.rowState = MODIFIED;
      } 
      column.onChange && column.onChange(row, column);
      }
    }, 
    initDrag(formTable,splitArea){
      let firstDrag=true;
      let formTableH = formTable.offsetHeight;
      formTable.style.height=formTableH+'px';

      splitArea.onmousedown = function (e) {
        if(firstDrag){
          formTable.style.flex='initial';
          firstDrag=false;
        }
        //记录鼠标开始位置
        let startY = e.clientY;
        //防抖初始时间
        let init_time = 0;
        //给得是document绑定事件
        document.onmousemove = function (e) {
          // 防抖
          const now_time = new Date();//现在时间
          if (now_time - init_time > 30) {//满足时间则执行
            init_time = now_time;
            //记录鼠标位置
            const endY = e.clientY;
            //计算鼠标移动距离
            const moveY = endY - startY;
            // 更新鼠标初始位置
            startY = endY;
            // 更新盒子宽度
            formTableH += moveY;
            // 边界值处理
            if (formTableH < 200) {
              formTableH = 200;
            }
            // if (formTableH > 800) {
            //   formTableH = 800
            // }

           formTable.style.height = formTableH + 'px';

          }//if
          return false;//阻止默认事件
        };
        //解除事件
        document.onmouseup = function () {
          document.onmousemove = null;
          document.onmouseup = null;
          // 释放鼠标
          splitArea.releaseCapture && splitArea.releaseCapture();
        };
        // 捕获鼠标
        splitArea.setCapture && splitArea.setCapture();
        return false;//阻止默认事件
      };

    },
    headerClick() {
      this.filterData.visible = false;
    },
    handleFInput() {
      let {
        filterValus: fVals,
        filterKey: sKey
      } = this.filterData;

      // 筛选 选择数据源
      let fRes = fVals.filter(val => {
        let v = val + '';
        return v.toLowerCase().includes(sKey.toLowerCase());
      });
      this.filterData.filterValus = fRes;
    },

    handleFChange() {
      let {
        checkFilterVals: cVals,//选择的筛选值
        column: { field,bind }
      } = this.filterData;

      if (cVals.length === 0) {
        let rowData = this.rowData;
        rowData=[...this.rowDataCopy];
        this.setTableRows(rowData);//设置表格数据
      } 
      
      else if(!bind || bind.data.length === 0){  //如果column的bind为空,即table的值没有映射关系
        let rows = this.rowDataCopy.filter(row => {
          let v = row[field] + '';
          //console.log(v);
          let res = cVals.some(val =>{
            if(val === "(为空)" && (v === "" || v === "null")){
              return true;
            }
            return v.toLowerCase() === (val + '').toLowerCase();
          });
          return res;
        });
        this.setTableRows(rows);
      }//else if
      
      else {
        const valMap = bind.data;
        let rows = this.rowDataCopy.filter(row => {
          let v = row[field] + '';
          let res = cVals.some(curCheckV =>{
            //console.log(v);
            if(curCheckV === "(为空)" && (v === "" || v === "null")){
              return true;
            }
            const curValMap = valMap.find(x => {
              return x.key + '' === v;
            });

            return curValMap && curValMap.value === curCheckV;
          });
          return res;
        });
        this.setTableRows(rows);
      }//else
    },
    setTableRows(rows) {
      if (this.url) {
        this.rowData = rows;
      } else {
        this.tableData = rows;
      }
    },
    // 清空搜索内容
    // handleFClear() {
    //   this.resetFilter();
    //   this.setTableRows(this.rowDataCopy);
    // },
    // 重置
    resetFilter() {
      this.filterData.checkFilterVals = [];
      this.handleFChange();
    },

    getCkvalues(rows, k) {
      let allFilterV = new Set();
      for (let i = 0,len=rows.length ; i < len; i++) {
        allFilterV.add(rows[i][k]);
      }//for
      if(allFilterV.has(null) && allFilterV.has("")){
        allFilterV.delete('');
      }
      
      allFilterV = Array.from(allFilterV);
      for (let i = allFilterV.length - 1; i >= 0; i--) {
        if (!allFilterV[i]) {
          allFilterV[i] = "(为空)";
        }
      }//for
      return allFilterV;
    },
    openFilter(event,column) {
      if(this.filterData.column && column.field != this.filterData.column.field){ //如果筛选条件和上次不同
        this.filterData.checkFilterVals=[];
        this.filterData.filterKey="";
      }

      let { pageX, pageY } = event;
      let popWidth = this.$refs.filterRef.offsetWidth;
      let wWidth = window.innerWidth;
      if (pageX + popWidth > wWidth) {
        this.fPosition.x = wWidth - popWidth - 30;
      } else {
        this.fPosition.x = pageX;
      }
      this.fPosition.y = pageY + 15;

      this.filterData.filterKey="";
      this.filterData.visible = true;
      let { field } = column;
      let tData = this.url ? this.rowDataCopy : this.tableData;
      
      let fValues = this.getCkvalues(tData, field);
      this.filterData = {
        ...this.filterData,
        filterValus: fValues,
        type: column.type,
        binds: column?.bind?.data || [],
        column
      };
    },
    refreshColumns() {
      this.loadCompData && this.loadCompData(this.tableName, true);
    },
    formatDate(row, field) {
      if (row[field]) {
        return format(new Date(row[field]), 'yyyy-MM-dd');
      }
      return '';
    },
    formatTime(row, field) {
      if (row[field]) {
        if (/^[1-9][0-9]{3}/.test(row[field])) {
          return format(new Date(row[field]), 'HH:mm:ss');
        }
        return row[field];
      }
      return '';
    },
    insertRow(row) {
      if (!this.url) return;
      if (this.curRow && this.curRow.editStatus) {
        this.curRow.editStatus = false;
      }
      this.rowData = this.rowData.concat(row);
      
      this.curRow = Array.isArray(row) ? row[0] : row;
    },
    // delIndex 索引集合
    delRows(delIndex) {
      
      let rowData = this.rowData;
      let delRows = [];
      for (let i = 0; i < rowData.length; ) {
        let item = rowData[i];
        
        if (delIndex.includes(item.rowIndex)) {
          delRows.push(item);
          rowData.splice(i, 1);
        } else {
          i++;
        }
      }
      this.rowData = rowData;
      return delRows;
    },
    getRules(column) {
      // console.log(column);
      if (column?.edit?.rules) {
        // console.log(column.edit.rules);
        return column.edit.rules;
      }
      if (
        column.require &&
        !['checkbox', 'switch'].includes(column.edit.type)
      ) {
        return [
          {
            required: true,
            trigger: 'blur',
            validator: (rule, value, callback) => {
              //console.log(value);
              if (isVoid(value)) {
                callback(new Error(column.title + '为必填项'));
              } else {
                callback();
              }
            }
          }
        ];
      }
      return [];
    },
    getDateFormat(type) {
      return type == 'date' ? 'YYYY-MM-DD' : 'YYYY-MM-DD HH:mm:ss';
    },
    // 行判断是否有附件
    getHaveAttch(row) {
      let res = this.attachmentCount.some(item => {
        return (
          item.code == row[this.keyCode] &&
          item.key == this.primaryKey &&
          item.value == row[this.primaryKey]
        );
      });
      return res;
    },
    checkBoxValue(row, column, value) {
      if (column.formatter) {
        return column.formatter();
      }
      if (typeof value === 'boolean') {
        return value;
      } else if (typeof value === 'string') {
        // 注意 2022-06-30 kai row的值为'0','1' 转为 0,1 否则switch checkbox识别不出字符串值
        // 如果有影响可以删除或修补
        row[column.field] = Number(value);
        return value === '1' ? true : false;
      } else if (typeof value === 'number') {
        return value === 1 ? true : false;
      }
    },
    getSelectKeyValue() {
      // 从后台加下拉框的[是否启用的]数据源
      let keys = [];
      let columnBind = [];
      this.columns.forEach((x, _index) => {
        if (
          x.bind &&
          x.bind.key &&
          (!x.bind.data || x.bind.data.length === 0)
        ) {
          // 写入远程
          if (!x.bind.data) x.bind.data = [];
          if (x.bind.remote) {
            this.remoteColumns.push(x);
          } else if (this.loadKey) {
            if (!keys.includes(x.bind.key)) {
              keys.push(x.bind.key);
            }
            x.bind.valueTyoe = x.type;
            columnBind.push(x.bind);
          }
        }
      });
      if (keys.length > 0) {
        
        this.http
          .post('/api/Sys_Dictionary/GetVueDictionary', keys)
          .then(dicList => {
            // 2020-06-30 kai 修改代码
            dicList.forEach(dic => {
              let col = columnBind.find(col => col.key === dic.dicNo);
              let dicData = dic?.data || [];
              if (col.valueTyoe == 'int') {
                dicData.forEach(item => {
                  let numKey = Number(item.key);
                  item.key = isNaN(numKey) ? item.key : numKey;
                });
              }
              col.data = dic.data;
            });

          })
          .catch(err => {
            this.$message.error(err.message);
            console.error(err);
          });
      }
    },
    itemChanged(row, column, callback) {
      let oldVal = this.copyCurRow[column.field];
      let newVal = row[column.field];
      if (oldVal == newVal) return;
      this.$emit(
        'dItemChanged',
        row,
        column,
        this.filterColumns,
        this.originalRoundNum,
        this.getFormatNum,
        callback
      );
    },
    // 获得焦点时
    focus(row, value, column) {
      this.setCopyRow(row);
    },
    // 主表打开 baseinfobox
    openBaseInfo(column, row) {
      this.$emit('openBaseInfo', column, row);
    },
    // 拷贝 点击行
    setCopyRow(row, replace = false) {
      if (!row.rowState || row.rowState === UNCHANGED || replace) {
        this.copyCurRow = { ...row };
      }
    },
    onChange(row, column) {
      // 2022-08-05 kai 只要触发change事件 就改变行状态
      if (!row.rowState||row.rowState === UNCHANGED) {
        row.rowState = MODIFIED;
      }

      column.onChange && column.onChange(row, column);
    },
    // 2022-04-18 kai 代码注释 暂时没看到table有这个需求 并且这个代码需要修补
    // 2022-04-21 kai 从t_Item找到数据
    // blurquerySearch
    getDataByInvCode(row, column) {
      this.onChange(row, column);
      if (this.itemChanged) {
        this.itemChanged(row, column);
      }
      // return;
      let sql = `select * from t_Item where cInvCode = '${row[column.field]}'`;
      this.http
        .post(`api/Sys_Role/ExecuteSqlQuery?SQL=${sql}`)
        .then(({ status, message, data }) => {
          if (!status) return ElMessage.error(message);
          let codeData = data[0];
          // console.log(codeData);
          if (!codeData) return;
          const { baseInfoData } = column.baseInfoTable;
          // console.log(baseInfoData);
          if (baseInfoData.__proto__ !== Object.prototype) {
            throw new Error('baseInfoData类型是Object');
          }
          for (const key in baseInfoData) {
            if (baseInfoData.hasOwnProperty(key)) {
              row[key] = codeData[baseInfoData[key]];
            }
          }
        });
    },
    // 设置行状态  修改过的行(rowState:MODIFIED)和新增不再修改
    setRowState(row, column) {
      let oldVal = this.copyCurRow[column.field];
      let isSame = true;
      switch (column.edit.type) {
        case 'decimal':
        case 'float':
        case 'int':
        case 'number':
          isSame = Number(oldVal) === Number(row[column.field]);
          break;
        case 'date':
        case 'datetime':
        case 'time':
          //console.log(oldVal, row[column.field]);
          isSame = oldVal == row[column.field]; //moment(oldVal).isSame(moment(row[column.field]));
          break;
        default:
          isSame = oldVal === row[column.field];
          break;
      }
      if (!isSame) {
        row.rowState = MODIFIED;
      }
    },
    handleBlur(row, column) {
      // 没有行状态和未修改的行 设置行状态  setRowState
      if (!row.rowState || row.rowState === UNCHANGED) {
        this.setRowState(row, column);
      }
      this.itemChanged(row, column);
    },
    getLoadParam(query) {
      let { page, size, sort, order } = this.paginations;
      let param = {
        page,
        rows: size,
        sort: [{ colName: sort, order }],
        order,
        wheres: [], // 查询条件，格式为[{ name: "字段", value: "xx" }]
        tableName: this.tableName,
        //TODO: 这里放了东电化的公司号,不过演示组件不需要展示数据
        companyId: "0002"
      };
      if(this.tableName=='t_SchProduct'){
        param.page=0;
        param.rows=0;
      }
      query &&(param = {
          ...param,
          ...query,
          sort: param.sort.concat(query.sort || [])
        });
      return param;
    },
    /**
     * config:{ resetPage:重置分页, tableName：表明 }
     * query: 查询参数getLoadParam函数自行查看
     */
    // 
  async  load(query, config) {
      if (!this.url) return;
      // resetPage重置分页数据
      if (config?.resetPage) {
        await  this.resetPage();
      }
      console.log("load query",query,config);
      let execState = true;
       let param = this.getLoadParam(query);
      this.$emit(
        'loadBefore',
        param,
        (result = true) => {
          execState = result;
        },
        config?.tableName
      );
      if (!execState) return;

      
      param.sort = JSON.stringify(param.sort);
      param.wheres = JSON.stringify(param.wheres);
      this.loading = true;
      await  this.http.post(this.url, param).then(
        ({ status, msg, dtMain: rows, total }) => {
          if (status !== 0) return ElMessage.error(msg);
          this.loading = false;
          //console.log(config?.tableName,JSON.parse(JSON.stringify(this.curRow)));
          let prevCurRow = JSON.parse(JSON.stringify(this.curRow || {}));
          let prevRow = rows.find(
            row => row[this.primaryKey] === prevCurRow[this.primaryKey]
          );
          this.$emit(
            'loadAfter',
            rows,
            (flag = true) => {
              execState = flag;
            },
            config?.tableName,
            prevRow
          );
          // console.log(execState);
          if (!execState) return;
          
          this.paginations.total = total;
          //console.log(this.tableName,'loadTableNmae')
          // if(this.tableName=='t_SchProduct'){
          //   console.log(rows)
          // }else{
            this.rowData = rows;
          // }
          // this.GetTableDictionary(rows);
          // console.log(this.rowData);
           //console.log('load(query, config) ',this.rowData);

          this.loadAfterSetRow(prevRow);
          this.setRowDataCopy(this.rowData);
          //重置清空过滤条件
          this.filterData={
            visible: false,
            filterValus: [],
            checkFilterVals: [],
            type: '',
            binds: [],
            filterKey: '',
            column: null
          };
        },
      );
    },
    // 2021-12-07 kai
    loadAfterSetRow(prevRow) {
      this.selection.splice(0); // 刷新 清空选中行
      let row = prevRow || this.rowData[0];
      if (row) {
        this.$nextTick(() => {
          this.setHiglightCurrentRow(row);
        });
      }
    },
    dowloadFile(file) {
      ElMessage({
        message: '演示组件不支持暂下载功能!',
        type: 'warning',
      });
      // dowloadFile(
      //   file.path,
      //   file.name,
      //   {
      //     Authorization: this.$store.getters.getToken
      //   },
      //   this.http.ipAddress
      // );
    },
    getFilePath(pathSring, column) {
      // 获取表的图片与文件显示
      if (!pathSring) return [];
      // 增加图片自定义操作
      // 返回格式必须是[{name:"文件名",path:"图片全路径或base64格式"}]
      if (column.formatter) {
        return column.formatter(pathSring);
      }
      let filePath = pathSring.replace(/\\/g, '/').split(',');
      let fileInfo = [];
      for (let index = 0; index < filePath.length; index++) {
        let file = filePath[index];
        // 2020.12.19增加base64图片显示
        if (column.base64) {
          fileInfo.push({
            name: '',
            path:
              (file.indexOf('base64,') == -1 ? 'data:image/png;base64,' : '') +
              file
          });
        } else if (file.indexOf('.') != -1) {
          let splitFile = file.split('/');
          if (splitFile.length > 0) {
            fileInfo.push({
              name: splitFile[splitFile.length - 1],
              path: checkUrl(file) ? file : this.http.ipAddress + file
            });
          }
        }
      }
      return fileInfo;
    },
    // 重置table
    reset() {
      if (this.tableData && this.tableData.length > 0) {
        this.tableData.splice(0);
      }
      if (this.rowData && this.rowData.length > 0) {
        this.rowData.splice(0);
      }
      if (!this.paginationHide) {
        this.paginations.page = 1;
        this.paginations.rows = 999999999;
        if (this.paginations.wheres && this.paginations.wheres.length > 0) {
          this.paginations.wheres.splice(0);
        }
      }
      this.errorFiled = '';
      this.edit.columnIndex = -1;
      this.edit.rowIndex = -1;
    },
    getSelectedOptions(column) {
      if (column.bind && column.bind.data && column.bind.data.length > 0) {
        return column.bind.data;
      }
      return [];
    },
    formatterClick(row, column, event) {
      column.click && column.click(row, column, event);
    },
    viewImg(row, column, url) {
      previewImg(url);
      window.open(row[column.field]);
    },
    rowDbClick({ row, column, $event }) {
      clearTimeout(timer);
      // 2021.05.23增加双击行事件
      this.$emit('rowDbClick', row, column, $event);
    },

    // 设置编辑行
    setEditRow(row) {
      if (this.curRow) {
        this.curRow.editStatus = false;
      }
      row.editStatus = true;
    },
    setHiglightCurrentRow(row, callBack) {
      this.$refs?.table?.setCurrentRow(row);
      callBack && callBack();
    },
    rowClick({ row, column, $event }) {
      if (this.clickEdit) {
        this.setEditRow(row);
      }
      this.curRow = row;
      timer && clearTimeout(timer);
      timer = setTimeout(() => {
        this.$emit('rowClick', row, column, $event);
      }, time);
    },
    // 手动选择 单选  2021-12-07 kai
    selectRow(selection, row) {
      this.setHiglightCurrentRow(row);
      this.addSelectionRow(row);
    }, 
    // 删除选中行 row当前行 add直接添加
    addSelectionRow(row, add = false) {
      // 2022-05-30 kai 新增行直接添加选择
      if (add || row.rowState === ADDED) {
        this.selection.push(row);
        return;
      }
      let index = this.selection.findIndex(
        item => item[this.primaryKey] == row[this.primaryKey]
      );
      if (index >= 0) {
        console.log(index);
        let unSelectRow = this.selection.splice(index, 1);
        console.log(unSelectRow, unSelectRow[0]);
        this.$emit('setCurRow', null, unSelectRow[0]);
      } else {
        this.selection.push(row);
        this.$emit('setCurRow', row);
      }
      // console.log(this.selection);
    },
    // 手动全选  2021-12-07 kai
    selectAllRow(selection) {
      if (selection.length) {
        this.selection.splice(0, this.selection.length, ...selection);
      } else {
        this.selection.splice(0);
      }
      this.$emit('setCurRow', null);
    },
    // 清空选中行
    clearSelected() {
      this.selection = [];
    },
    // 设置选中行
    getSelected() {
      return this.selection;
    },
    // 获取选中行索引
    getSelectedIndex() {
      // console.log(this.getSelected());
      return this.getSelected()?.map(item => item.rowIndex);
    },
    handleSizeChange(val) {

        this.load();
    },
    handleCurrentChange(val) {
      this.load();
    },
    sortChange(sort) {
      this.paginations.sort = sort.prop;
      this.paginations.order = sort.order == 'ascending' ? 'asc' : 'desc';
      this.load();
    },
    // 重置查询分页
    resetPage() {
      this.paginations = { ...this.paginations, rows: 100, page: 1 };
    },
    initIndex({ row, rowIndex }) {
      row.rowIndex = rowIndex;
      return '';
    },
    getCellStyle({ row, column, rowIndex, columnIndex }) {
        let col = this.columns.find(v=>v.field==column.property);
        if (col && typeof col.cellStyle === 'function') { 
        return col.cellStyle(row, column, rowIndex, columnIndex);
      }
    },
    getSummary({ columns, data }) {
      // 需合计列字段
      const sumField = [];
      this.columns.forEach(col => {
        if (col.summary) {
          sumField.push(col.field);
        }
      });
      if (!sumField.length) return ['合计'];
      // console.log(sumField);
      // console.log(columns);
      const sums = [];
      columns.forEach((column, index) => {
        if (index === 0) {
          sums[index] = '合计';
          return;
        }
        if (sumField.includes(column.property)) {
          const values = data.map(item => Number(item[column.property]));

          if (!values.every(value => isNaN(value))) {
            let sumNum = values.reduce((prev, curr) => {
              const value = Number(curr);
              if (!isNaN(value)) {
                return prev + curr;
              } else {
                return prev;
              }
            }, 0);
            let formatSumNum = this.getFormatNum(sumNum, column.property);
            sums[index] = formatSumNum;
          } else {
            sums[index] = '0';
          }
        } else {
          sums[index] = '';
        }
      });
      return sums;
    }
  },
  beforeUnmount() {
    if (timer) {
      clearTimeout(timer);
    }
  },
  updated() {
    // TODO：应该在这里初始化表格的排序和排序图标的显示
    // console.log('组件更新', this.$store.state.global.sortTableObj)
  }
});
const __injectCSSVars__ = () => {
useCssVars(_ctx => ({
  "a4a57bf4": (_ctx.tableRowBg)
}));};
const __setup__ = __default__.setup;
__default__.setup = __setup__
  ? (props, ctx) => { __injectCSSVars__();return __setup__(props, ctx) }
  : __injectCSSVars__;

const _sfc_main$1 = __default__;

const _withScopeId = n => (pushScopeId("data-v-e0e4e082"),n=n(),popScopeId(),n);
const _hoisted_1$1 = { calss: "slotTablehead" };
const _hoisted_2 = ["onClick"];
const _hoisted_3 = { style: {"float":"left"} };
const _hoisted_4 = { style: {"float":"right","color":"#ccc"} };
const _hoisted_5 = {
  key: 1,
  class: /*#__PURE__*/normalizeClass(`checkBoxDiv`),
  style: `width:100%;height:100%;`
};
const _hoisted_6 = ["onClick"];
const _hoisted_7 = ["innerHTML"];
const _hoisted_8 = { key: 2 };
const _hoisted_9 = { key: 3 };
const _hoisted_10 = ["onClick", "innerHTML"];
const _hoisted_11 = ["innerHTML"];
const _hoisted_12 = ["onClick", "innerHTML"];
const _hoisted_13 = ["onClick"];
const _hoisted_14 = ["innerHTML"];
const _hoisted_15 = ["innerHTML"];
const _hoisted_16 = ["innerHTML"];
const _hoisted_17 = ["onerror", "onClick", "src"];
const _hoisted_18 = ["onClick"];
const _hoisted_19 = ["onClick"];
const _hoisted_20 = ["innerHTML"];
const _hoisted_21 = { calss: "slotdefault" };
const _hoisted_22 = {
  key: 1,
  class: "pagination-wrapper"
};
const _hoisted_23 = { class: "divider" };
const _hoisted_24 = { class: "values-content" };
const _hoisted_25 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/createElementVNode("div", { class: "divider" }, null, -1));
const _hoisted_26 = { class: "filter-btn" };

function _sfc_render(_ctx, _cache, $props, $setup, $data, $options) {
  const _component_table_filter = resolveComponent("table-filter");
  const _component_vxe_column = resolveComponent("vxe-column");
  const _component_FilterIcon = resolveComponent("FilterIcon");
  const _component_el_icon = resolveComponent("el-icon");
  const _component_table_render = resolveComponent("table-render");
  const _component_el_checkbox = resolveComponent("el-checkbox");
  const _component_el_date_picker = resolveComponent("el-date-picker");
  const _component_el_time_picker = resolveComponent("el-time-picker");
  const _component_el_switch = resolveComponent("el-switch");
  const _component_el_option = resolveComponent("el-option");
  const _component_el_select = resolveComponent("el-select");
  const _component_el_checkbox_group = resolveComponent("el-checkbox-group");
  const _component_el_button = resolveComponent("el-button");
  const _component_el_input = resolveComponent("el-input");
  const _component_el_input_number = resolveComponent("el-input-number");
  const _component_el_form_item = resolveComponent("el-form-item");
  const _component_vxe_table = resolveComponent("vxe-table");
  const _component_el_form = resolveComponent("el-form");
  const _component_el_pagination = resolveComponent("el-pagination");
  const _component_context_menu = resolveComponent("context-menu");
  const _directive_loading = resolveDirective("loading");

  return (openBlock(), createElementBlock(Fragment, null, [
    createElementVNode("div", _hoisted_1$1, [
      renderSlot(_ctx.$slots, "slotTablehead", {}, undefined, true)
    ]),
    (_ctx.showFilterSearch)
      ? (openBlock(), createBlock(_component_table_filter, {
          key: 0,
          ref: "tableFilterRef",
          onFilterInputKeyUp: _ctx.filterInputKeyUp,
          onIsShowTableFilter: _ctx.changeTableFilterLabel
        }, null, 8, ["onFilterInputKeyUp", "onIsShowTableFilter"]))
      : createCommentVNode("", true),
    createVNode(_component_el_form, {
      class: normalizeClass(["form-table", { 'editor-form': _ctx.editType }]),
      ref: "formRef",
      model:  {rowData: _ctx.rowData} ,
      style: {"display":"flex","overflow":"hidden"}
    }, {
      default: withCtx(() => [
        withDirectives((openBlock(), createBlock(_component_vxe_table, {
          ref: "table",
          height: _ctx.height ?? 'auto',
          class: "el-table-custom-style",
          style: {"overflow":"hidden !important"},
          "element-loading-text": "数据加载中......",
          "element-loading-background": "rgba(255, 255, 255, .6)",
          size: "small",
          border: "",
          stripe: "",
          "highlight-current-row": "",
          "show-overflow": "tooltip",
          data: _ctx.url ? _ctx.rowData : _ctx.tableData,
          "column-config": {resizable: true},
          "row-config": {isHover: true, isCurrent: true,height:28},
          "header-cell-style": {textAlign: 'center', color: '#3c4353', backgroundColor: '#f5f7fa'},
          "cell-style": _ctx.getCellStyle,
          "menu-config": {},
          "row-class-name": _ctx.initIndex,
          "checkbox-config": {range: true},
          "mouse-config": {selected: true},
          "edit-config": {
        // trigger: 'dblclick', //2022 9 2 dxf 无需双击编辑
        mode: 'cell',
        showIcon: false},
          "keyboard-config": {
        isArrow: true,
        isEsc: true,
        isDel: true,
        isEnter: true,
        isTab: true,
        isChecked: true,
        // isEdit: true,//去除edit属性，因为没有数字输入约束
        editMethod: ({ row, column }) => _ctx.$refs.table.setActiveCell(row, column)
      },
          "sort-config": {
        multiple: true,
        chronological: true,
      },
          onHeaderCellDblclick: _ctx.headerSort,
          onCheckboxChange: _ctx.selectRow,
          onCheckboxAll: _ctx.selectAllRow,
          onSortChange: _ctx.sortChange,
          onCellClick: _ctx.rowClick,
          onCellDblclick: _ctx.rowDbClick,
          onHeaderCellClick: _ctx.headerClick,
          onHeaderCellMenu: _cache[0] || (_cache[0] = ({ column, $event }) => _ctx.openContextMenu('columnMenu', column, $event)),
          onCellMenu: _cache[1] || (_cache[1] = ({ row, column, $event }) => _ctx.openContextMenu('rowMenu', row, column, $event))
        }, {
          default: withCtx(() => [
            (_ctx.colIndex)
              ? (openBlock(), createBlock(_component_vxe_column, {
                  key: 0,
                  type: "seq",
                  width: "55",
                  align: "center",
                  fixed: _ctx.indexFixed
                }, null, 8, ["fixed"]))
              : createCommentVNode("", true),
            (_ctx.colSelection)
              ? (openBlock(), createBlock(_component_vxe_column, {
                  key: 1,
                  type: "checkbox",
                  width: "55",
                  align: "center",
                  fixed: _ctx.ckFixed
                }, null, 8, ["fixed"]))
              : createCommentVNode("", true),
            (openBlock(true), createElementBlock(Fragment, null, renderList(Object.entries(_ctx.columns), ([key,column]) => {
              return (openBlock(), createElementBlock(Fragment, { key: key }, [
                (typeof column.hidden === 'undefined' || column.hidden === false)
                  ? (openBlock(), createBlock(_component_vxe_column, {
                      key: 0,
                      "show-overflow-tooltip": !(column.edit && (!_ctx.editType)),
                      prop: column.field,
                      "show-header-overflow": "tooltip",
                      field: column.field,
                      label: column.title,
                      align: column.align,
                      "min-width": column.width,
                      fixed: column.fixed || false,
                      "header-cell-style": { color: '#407338', 'text-align': 'center' },
                      sortable: _ctx.sortable,
                      params: column,
                      "edit-render": {name: 'input'}
                    }, {
                      header: withCtx(() => [
                        createElementVNode("span", {
                          class: normalizeClass([column.required ? 'blueColumnTitle' : '', "column-title"])
                        }, toDisplayString(column.title), 3),
                        createElementVNode("span", {
                          onClick: withModifiers($event => (_ctx.openFilter($event,column)), ["stop"]),
                          class: "dropdown-filter-icon"
                        }, [
                          createVNode(_component_el_icon, { size: 10 }, {
                            default: withCtx(() => [
                              createVNode(_component_FilterIcon)
                            ]),
                            _: 1
                          })
                        ], 8, _hoisted_2)
                      ]),
                      default: withCtx(({ row, $rowIndex:$index,column:$col }) => [
                        (column.render && typeof column.render == 'function')
                          ? (openBlock(), createBlock(_component_table_render, {
                              key: 0,
                              row: row,
                              index: $index,
                              column: column,
                              render: column.render
                            }, null, 8, ["row", "index", "column", "render"]))
                          : (column.attachment)
                            ? (openBlock(), createBlock(_component_el_checkbox, {
                                key: 1,
                                disabled: "",
                                "model-value": _ctx.getHaveAttch(row),
                                style: {"height":"auto"}
                              }, null, 8, ["model-value"]))
                            : createCommentVNode("", true),
                        (_ctx.editType || row.editStatus)
                          ? (openBlock(), createElementBlock(Fragment, { key: 2 }, [
                              (column.edit)
                                ? (openBlock(), createBlock(_component_el_form_item, {
                                    key: 0,
                                    rules: _ctx.getRules(column),
                                    prop: column.field
                                  }, {
                                    default: withCtx(() => [
                                      (['date', 'datetime'].includes(column.edit.type))
                                        ? (openBlock(), createBlock(_component_el_date_picker, {
                                            key: 0,
                                            class: "input-date-center",
                                            style: {"width":"100%"},
                                            transfer: "",
                                            size: "small",
                                            type: column.edit.type,
                                            format: _ctx.getDateFormat(column.edit.type),
                                            "value-format": _ctx.getDateFormat(column.edit.type),
                                            modelValue: row[column.field],
                                            "onUpdate:modelValue": $event => ((row[column.field]) = $event),
                                            disabled: column.edit.disabled,
                                            onChange: $event => (_ctx.onChange(row, column)),
                                            onFocus: $event => (_ctx.focus(row, row[column.field], column))
                                          }, null, 8, ["type", "format", "value-format", "modelValue", "onUpdate:modelValue", "disabled", "onChange", "onFocus"]))
                                        : (column.edit.type == 'time')
                                          ? (openBlock(), createElementBlock(Fragment, { key: 1 }, [
                                              createElementVNode("span", null, toDisplayString(row[column.field]), 1),
                                              createVNode(_component_el_time_picker, {
                                                style: {"width":"100%"},
                                                size: "small",
                                                modelValue: row[column.field],
                                                "onUpdate:modelValue": $event => ((row[column.field]) = $event),
                                                "value-format": "HH:mm:ss",
                                                disabled: column.edit.disabled,
                                                onChange: $event => (_ctx.onChange(row, column)),
                                                onFocus: $event => (_ctx.focus(row, row[column.field], column))
                                              }, null, 8, ["modelValue", "onUpdate:modelValue", "disabled", "onChange", "onFocus"])
                                            ], 64))
                                          : (column.edit.type == 'switch')
                                            ? (openBlock(), createBlock(_component_el_switch, {
                                                key: 2,
                                                modelValue: row[column.field],
                                                "onUpdate:modelValue": $event => ((row[column.field]) = $event),
                                                disabled: column.edit.disabled,
                                                "active-value": _ctx.getActiveValue(row[column.field]),
                                                "inactive-value": _ctx.getInActiveValue(row[column.field]),
                                                "inline-prompt": "",
                                                onChange: $event => (_ctx.onChange(row, column))
                                              }, null, 8, ["modelValue", "onUpdate:modelValue", "disabled", "active-value", "inactive-value", "onChange"]))
                                            : (column.edit.type == 'select')
                                              ? (openBlock(), createBlock(_component_el_select, {
                                                  key: 3,
                                                  transfer: "",
                                                  size: "small",
                                                  modelValue: row[column.field],
                                                  "onUpdate:modelValue": $event => ((row[column.field]) = $event),
                                                  disabled: column.edit.disabled,
                                                  filterable: 
                        column.filter || _ctx.getSelectedOptions(column).length > 10
                          ? true
                          : false
                      ,
                                                  onChange: $event => (_ctx.onChange(row, column)),
                                                  onFocus: $event => (_ctx.focus(row, row[column.field], column)),
                                                  clearable: ""
                                                }, {
                                                  default: withCtx(() => [
                                                    (openBlock(true), createElementBlock(Fragment, null, renderList(_ctx.getSelectedOptions(column), (kv) => {
                                                      return (openBlock(), createBlock(_component_el_option, {
                                                        key: kv.key,
                                                        label: kv.value,
                                                        value: kv.key
                                                      }, {
                                                        default: withCtx(() => [
                                                          createElementVNode("span", _hoisted_3, toDisplayString(kv.value), 1),
                                                          createElementVNode("span", _hoisted_4, toDisplayString(kv.key), 1)
                                                        ]),
                                                        _: 2
                                                      }, 1032, ["label", "value"]))
                                                    }), 128))
                                                  ]),
                                                  _: 2
                                                }, 1032, ["modelValue", "onUpdate:modelValue", "disabled", "filterable", "onChange", "onFocus"]))
                                              : (column.edit.type === 'checkbox')
                                                ? (openBlock(), createElementBlock(Fragment, { key: 4 }, [
                                                    (column.edit.data)
                                                      ? (openBlock(), createBlock(_component_el_checkbox_group, {
                                                          key: 0,
                                                          onChange: $event => (_ctx.onChange(row, column))
                                                        }, {
                                                          default: withCtx(() => [
                                                            (openBlock(true), createElementBlock(Fragment, null, renderList(column.edit.data, (ckbox) => {
                                                              return (openBlock(), createBlock(_component_el_checkbox, {
                                                                key: ckbox.key,
                                                                label: _ctx.item.key
                                                              }, {
                                                                default: withCtx(() => [
                                                                  createTextVNode(toDisplayString(_ctx.item.value), 1)
                                                                ]),
                                                                _: 2
                                                              }, 1032, ["label"]))
                                                            }), 128))
                                                          ]),
                                                          _: 2
                                                        }, 1032, ["onChange"]))
                                                      : (openBlock(), createElementBlock("div", _hoisted_5, [
                                                          createVNode(_component_el_checkbox, {
                                                            style: {"height":"auto"},
                                                            modelValue: row[column.field],
                                                            "onUpdate:modelValue": $event => ((row[column.field]) = $event),
                                                            "true-label": 1,
                                                            "false-label": 0,
                                                            disabled: 
                        typeof column.edit.disabled === 'function'
                          ? column.edit.disabled(row) 
                          : column.edit.disabled==undefined?true:column.edit.disabled
                      ,
                                                            onChange: $event => (_ctx.onChange(row, column))
                                                          }, null, 8, ["modelValue", "onUpdate:modelValue", "disabled", "onChange"])
                                                        ]))
                                                  ], 64))
                                                : (column.edit.type == 'BaseInfo')
                                                  ? (openBlock(), createBlock(_component_el_input, {
                                                      key: 5,
                                                      size: "small",
                                                      onFocus: $event => (_ctx.focus(row, row[column.field])),
                                                      onBlur: $event => (_ctx.getDataByInvCode(row, column)),
                                                      modelValue: row[column.field],
                                                      "onUpdate:modelValue": $event => ((row[column.field]) = $event),
                                                      modelModifiers: { trim: true },
                                                      disabled: column.edit.disabled
                                                    }, {
                                                      append: withCtx(() => [
                                                        createVNode(_component_el_button, {
                                                          size: "small",
                                                          icon: _ctx.SearchIcon,
                                                          onClick: $event => (_ctx.openBaseInfo(column, row))
                                                        }, null, 8, ["icon", "onClick"])
                                                      ]),
                                                      _: 2
                                                    }, 1032, ["onFocus", "onBlur", "modelValue", "onUpdate:modelValue", "disabled"]))
                                                  : (
                      ['int', 'number', 'decimal', 'float'].includes(
                        column.edit.type
                      )
                    )
                                                    ? (openBlock(), createBlock(_component_el_input_number, {
                                                        key: 6,
                                                        class: "input-number-right",
                                                        style: {"width":"100% !important"},
                                                        size: "small",
                                                        controls: false,
                                                        "controls-position": "right",
                                                        onFocus: $event => (_ctx.originalNum(row, column,$index)),
                                                        onBlur: $event => (_ctx.roundNum(row, column,$index)),
                                                        onChange: $event => (_ctx.onChange(row, column)),
                                                        modelValue: row[column.field],
                                                        "onUpdate:modelValue": $event => ((row[column.field]) = $event),
                                                        disabled: column.edit.disabled
                                                      }, null, 8, ["onFocus", "onBlur", "onChange", "modelValue", "onUpdate:modelValue", "disabled"]))
                                                    : (openBlock(), createBlock(_component_el_input, {
                                                        key: 7,
                                                        clearable: "",
                                                        size: "small",
                                                        onFocus: $event => (_ctx.focus(row, row[column.field], column)),
                                                        onBlur: $event => (_ctx.handleBlur(row, column)),
                                                        modelValue: row[column.field],
                                                        "onUpdate:modelValue": $event => ((row[column.field]) = $event),
                                                        disabled: column.edit.disabled
                                                      }, null, 8, ["onFocus", "onBlur", "modelValue", "onUpdate:modelValue", "disabled"])),
                                      (column.extra && _ctx.edit.rowIndex == $index)
                                        ? (openBlock(), createElementBlock("a", {
                                            key: 8,
                                            style: normalizeStyle(column.extra.style),
                                            onClick: 
                        () => {
                          column.extra.click &&
                            column.extra.click(
                              column,
                              row,
                              _ctx.url ? _ctx.rowData : _ctx.tableData
                            );
                        }
                      
                                          }, toDisplayString(column.extra.text), 13, _hoisted_6))
                                        : createCommentVNode("", true)
                                    ]),
                                    _: 2
                                  }, 1032, ["rules", "prop"]))
                                : (column.formatter)
                                  ? (openBlock(), createElementBlock("span", {
                                      key: 1,
                                      innerHTML: column.formatter(row, column)
                                    }, null, 8, _hoisted_7))
                                  : (column.type == 'date')
                                    ? (openBlock(), createElementBlock("span", _hoisted_8, toDisplayString(_ctx.formatDate(row, column.field)), 1))
                                    : (openBlock(), createElementBlock("span", _hoisted_9, toDisplayString(row[column.field]), 1))
                            ], 64))
                          : (openBlock(), createElementBlock(Fragment, { key: 3 }, [
                              (column.formatter)
                                ? (openBlock(), createElementBlock("span", {
                                    key: 0,
                                    onClick: $event => (_ctx.formatterClick(row, column)),
                                    innerHTML: column.formatter(row, column)
                                  }, null, 8, _hoisted_10))
                                : (column.bind)
                                  ? (openBlock(), createElementBlock("span", {
                                      key: 1,
                                      innerHTML: _ctx.formatter(row, column, true)
                                    }, null, 8, _hoisted_11))
                                  : (column.normal)
                                    ? (openBlock(), createElementBlock("span", {
                                        key: 2,
                                        onClick: $event => (_ctx.formatterClick(row, column)),
                                        style: normalizeStyle(column.getStyle && column.getStyle(row, column)),
                                        innerHTML: _ctx.formatter(row, column, true)
                                      }, null, 12, _hoisted_12))
                                    : (column.click)
                                      ? (openBlock(), createElementBlock("span", {
                                          key: 3,
                                          onClick: $event => (_ctx.formatterClick(row, column))
                                        }, toDisplayString(row[column.field]), 9, _hoisted_13))
                                      : (
                  ['int', 'number', 'decimal', 'float'].includes(column.type)
                )
                                        ? (openBlock(), createElementBlock("span", {
                                            key: 4,
                                            innerHTML: 
                  _ctx.showData(row, column, _ctx.formatNumber(row, column, $index))
                
                                          }, null, 8, _hoisted_14))
                                        : (column.type == 'date')
                                          ? (openBlock(), createElementBlock("span", {
                                              key: 5,
                                              innerHTML: _ctx.showData(row, column, _ctx.formatDate(row, column.field))
                                            }, null, 8, _hoisted_15))
                                          : (column.type == 'time')
                                            ? (openBlock(), createElementBlock("span", {
                                                key: 6,
                                                innerHTML: _ctx.showData(row, column, _ctx.formatTime(row, column.field))
                                              }, null, 8, _hoisted_16))
                                            : (column.type == 'img')
                                              ? (openBlock(true), createElementBlock(Fragment, { key: 7 }, renderList(_ctx.getFilePath(
                    row[column.field],
                    column
                  ), (file, vIndex) => {
                                                  return (openBlock(), createElementBlock("img", {
                                                    key: column.field + vIndex,
                                                    onerror: _ctx.errorPng,
                                                    onClick: $event => (_ctx.viewImg(row, column, file.path)),
                                                    class: "table-img",
                                                    src: file.path
                                                  }, null, 8, _hoisted_17))
                                                }), 128))
                                              : (column.type == 'file' || column.type == 'excel')
                                                ? (openBlock(true), createElementBlock(Fragment, { key: 8 }, renderList(_ctx.getFilePath(
                    row[column.field],
                    column
                  ), (file, vIndex) => {
                                                    return (openBlock(), createElementBlock("a", {
                                                      key: column.field + vIndex,
                                                      style: {"margin-right":"15px"},
                                                      class: "t-file",
                                                      onClick: $event => (_ctx.dowloadFile(file))
                                                    }, toDisplayString(file.name), 9, _hoisted_18))
                                                  }), 128))
                                                : (['bool', 'byte'].includes(column.type))
                                                  ? (openBlock(), createElementBlock("div", {
                                                      key: 9,
                                                      class: "checkBoxDiv",
                                                      onClick: $event => (_ctx.changeChildValue(row,_ctx.columns[key]))
                                                    }, [
                                                      createVNode(_component_el_checkbox, {
                                                        disabled: true,
                                                        style: {"height":"auto"},
                                                        "model-value": _ctx.checkBoxValue(row,column,row[column.field])
                                                      }, null, 8, ["model-value"])
                                                    ], 8, _hoisted_19))
                                                  : (column.type === 'switch')
                                                    ? (openBlock(), createBlock(_component_el_switch, {
                                                        key: 10,
                                                        disabled: "",
                                                        "model-value": _ctx.checkBoxValue(row,column,row[column.field])
                                                      }, null, 8, ["model-value"]))
                                                    : (openBlock(), createElementBlock("span", {
                                                        key: 11,
                                                        innerHTML: _ctx.formatter(row, column, true)
                                                      }, null, 8, _hoisted_20))
                            ], 64))
                      ]),
                      _: 2
                    }, 1032, ["show-overflow-tooltip", "prop", "field", "label", "align", "min-width", "fixed", "sortable", "params"]))
                  : createCommentVNode("", true)
              ], 64))
            }), 128))
          ]),
          _: 1
        }, 8, ["height", "data", "cell-style", "row-class-name", "keyboard-config", "onHeaderCellDblclick", "onCheckboxChange", "onCheckboxAll", "onSortChange", "onCellClick", "onCellDblclick", "onHeaderCellClick"])), [
          [_directive_loading, _ctx.loading]
        ])
      ]),
      _: 1
    }, 8, ["model", "class"]),
    createElementVNode("div", _hoisted_21, [
      renderSlot(_ctx.$slots, "default", {}, undefined, true)
    ]),
    (!_ctx.paginationHide)
      ? (openBlock(), createElementBlock("div", _hoisted_22, [
          createVNode(_component_el_pagination, {
            small: "",
            background: "",
            onSizeChange: _ctx.handleSizeChange,
            onCurrentChange: _ctx.handleCurrentChange,
            currentPage: _ctx.paginations.page,
            "onUpdate:currentPage": _cache[2] || (_cache[2] = $event => ((_ctx.paginations.page) = $event)),
            "page-size": _ctx.paginations.size,
            "onUpdate:page-size": _cache[3] || (_cache[3] = $event => ((_ctx.paginations.size) = $event)),
            "page-sizes": _ctx.paginations.sizes,
            layout: "total, sizes, prev, pager, next, jumper",
            total: _ctx.paginations.total
          }, null, 8, ["onSizeChange", "onCurrentChange", "currentPage", "page-size", "page-sizes", "total"])
        ]))
      : createCommentVNode("", true),
    (_ctx.showCtxMenu)
      ? (openBlock(), createBlock(_component_context_menu, {
          key: 2,
          ref: "ctxMenuRef",
          menuList: _ctx.contextMenu.list
        }, null, 8, ["menuList"]))
      : createCommentVNode("", true),
    withDirectives(createElementVNode("div", {
      class: "dropdown-filter-pop",
      style: normalizeStyle(_ctx.getFilterStyle),
      ref: "filterRef"
    }, [
      createVNode(_component_el_input, {
        size: "small",
        modelValue: _ctx.filterData.filterKey,
        "onUpdate:modelValue": _cache[4] || (_cache[4] = $event => ((_ctx.filterData.filterKey) = $event)),
        placeholder: "请输入需要查找的值"
      }, {
        append: withCtx(() => [
          createVNode(_component_el_button, {
            type: "primary",
            icon: _ctx.SearchIcon,
            onClick: _ctx.handleFInput
          }, null, 8, ["icon", "onClick"])
        ]),
        _: 1
      }, 8, ["modelValue"]),
      withDirectives(createElementVNode("div", _hoisted_23, null, 512), [
        [vShow, _ctx.filterData.filterValus.length]
      ]),
      createElementVNode("div", _hoisted_24, [
        createVNode(_component_el_checkbox_group, {
          modelValue: _ctx.filterData.checkFilterVals,
          "onUpdate:modelValue": _cache[5] || (_cache[5] = $event => ((_ctx.filterData.checkFilterVals) = $event)),
          class: "filter-checkboxgroup",
          onChange: _ctx.handleFChange
        }, {
          default: withCtx(() => [
            (openBlock(true), createElementBlock(Fragment, null, renderList(_ctx.filterData.filterValus, (v) => {
              return (openBlock(), createBlock(_component_el_checkbox, {
                label: _ctx.getFLabel(v),
                key: v
              }, null, 8, ["label"]))
            }), 128))
          ]),
          _: 1
        }, 8, ["modelValue", "onChange"])
      ]),
      _hoisted_25,
      createElementVNode("div", _hoisted_26, [
        createElementVNode("span", {
          onClick: _cache[6] || (_cache[6] = (...args) => (_ctx.resetFilter && _ctx.resetFilter(...args)))
        }, "重置"),
        createElementVNode("span", {
          onClick: _cache[7] || (_cache[7] = $event => (_ctx.filterData.visible = false))
        }, "关闭")
      ])
    ], 4), [
      [vShow, _ctx.filterData.visible]
    ])
  ], 64))
}
var VolTable = /*#__PURE__*/_export_sfc(_sfc_main$1, [['render',_sfc_render],['__scopeId',"data-v-e0e4e082"]]);

const component = [VolTable];

const ZKApsUI = {
	install(App) {
		component.forEach((item) => {
			App.component(item.name, item);
		});
	},
};

var VolTableRender = {
  name: "TableRender",
  functional: true,
  props: {
    render: Function,
    row: {},//当前行的数据
    column: {},//当前行的配置信息
    index: { type: Number, default: 0 }//当前所在行
  },
  render: ({ render, row, column, index }) => {
    return render(h, { row, column, index }); //h();
  }
};

var VolTableRender$1 = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  'default': VolTableRender
}, Symbol.toStringTag, { value: 'Module' }));

var ContextMenu_vue_vue_type_style_index_0_scoped_true_lang = '';

const _hoisted_1 = ["onClick"];


const _sfc_main = {
  __name: 'ContextMenu',
  props: {
  menuList: {
    type: Array,
    default: () => []
  }
},
  setup(__props, { expose }) {



const showCtxMenu = ref(false);
const menuRef = ref(null);
let ctxData = {};
let screenX = window.innerWidth;
let screenY = window.innerHeight;

const ctxMenuClick = inject('ctxMenuClick');
const menuClick = item => {
  ctxMenuClick(item, ctxData);
};

const show = (x, y, data) => {
  showCtxMenu.value = true;
  nextTick(() => {
    let height = menuRef.value.offsetHeight;
    let width = menuRef.value.offsetWidth;
    x += 10;
    y += 10;
    let _x = x > screenX - width ? screenX - width : x;
    let _y = y > screenY - height ? screenY - height : y;
    menuRef.value.style.left = _x + 'px';
    menuRef.value.style.top = _y + 'px';
    ctxData = data;
    console.log(data);
  });
};

document.addEventListener('click', () => {
  showCtxMenu.value = false;
});

expose({
  show
});

return (_ctx, _cache) => {
  return withDirectives((openBlock(), createElementBlock("div", {
    class: "context-menu",
    ref_key: "menuRef",
    ref: menuRef
  }, [
    (openBlock(true), createElementBlock(Fragment, null, renderList(__props.menuList, (item) => {
      return (openBlock(), createElementBlock("p", {
        class: "context-menu-item",
        key: item.label,
        onClick: $event => (menuClick(item))
      }, toDisplayString(item.label), 9, _hoisted_1))
    }), 128))
  ], 512)), [
    [vShow, showCtxMenu.value]
  ])
}
}

};
var ContextMenu = /*#__PURE__*/_export_sfc(_sfc_main, [['__scopeId',"data-v-3ae3a9b4"]]);

var ContextMenu$1 = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  'default': ContextMenu
}, Symbol.toStringTag, { value: 'Module' }));

export { VolTable, ZKApsUI as default };
