"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_dom=require("../../tools/dom");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,o=1,l=arguments.length;o<l;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},renderType="footer";function mergeFooterMethod(e,t,o){for(var l=0;l<e.length;l++){var r=e[l],n=r.row,a=r.col,c=r.rowspan,r=r.colspan;if(-1<a&&-1<n&&c&&r){if(n===t&&a===o)return{rowspan:c,colspan:r};if(n<=t&&t<n+c&&a<=o&&o<a+r)return{rowspan:0,colspan:0}}}}var _default2=(0,_vue.defineComponent)({name:"VxeTableFooter",props:{footerTableData:{type:Array,default:function(){return[]}},tableColumn:{type:Array,default:function(){return[]}},fixedColumn:{type:Array,default:function(){return[]}},fixedType:{type:String,default:null}},setup:function(i){function n(e){var t=i.fixedType,o=u.scrollXLoad,l=s.lastScrollLeft,r=p.value,n=f.value,a=d.value,c=n?n.$el:null,n=x.value,a=a.$el,l=(n=n.scrollLeft)!==l;s.lastScrollLeft=n,s.lastScrollTime=Date.now(),c&&(c.scrollLeft=n),a&&(a.scrollLeft=n),o&&l&&q.triggerScrollXEvent(e),l&&r&&r.reactData.visible&&r.updatePlacement(),q.dispatchEvent("scroll",{type:renderType,fixed:t,scrollTop:a.scrollTop,scrollLeft:n,isX:l,isY:!1},e)}var q=(0,_vue.inject)("$xetable",{}),a=q.xID,c=q.props,u=q.reactData,s=q.internalData,e=q.getRefMaps(),f=e.refTableHeader,d=e.refTableBody,p=e.refValidTooltip,e=q.getComputeMaps(),v=e.computeTooltipOpts,_=e.computeColumnOpts,x=(0,_vue.ref)(),m=(0,_vue.ref)(),g=(0,_vue.ref)(),y=(0,_vue.ref)(),h=(0,_vue.ref)();(0,_vue.onMounted)(function(){(0,_vue.nextTick)(function(){var e=i.fixedType,t=s.elemStore,e="".concat(e||"main","-footer-");t["".concat(e,"wrapper")]=x,t["".concat(e,"table")]=m,t["".concat(e,"colgroup")]=g,t["".concat(e,"list")]=y,t["".concat(e,"xSpace")]=h})}),(0,_vue.onUnmounted)(function(){var e=i.fixedType,t=s.elemStore,e="".concat(e||"main","-footer-");t["".concat(e,"wrapper")]=null,t["".concat(e,"table")]=null,t["".concat(e,"colgroup")]=null,t["".concat(e,"list")]=null,t["".concat(e,"xSpace")]=null});return function(){var b=i.fixedType,e=i.fixedColumn,T=i.tableColumn,C=i.footerTableData,t=c.footerRowClassName,I=c.footerCellClassName,o=c.footerRowStyle,S=c.footerCellStyle,F=c.footerAlign,D=c.footerSpanMethod,L=c.align,M=c.columnKey,O=c.showFooterOverflow,l=s.visibleColumn,$=u.scrollYLoad,U=u.overflowX,r=u.scrollbarWidth,k=u.currentColumn,j=u.mergeFooterList,A=v.value,E=_.value;return b&&(T=!$&&!O||j.length&&D?l:e),(0,_vue.h)("div",{ref:x,class:["vxe-table--footer-wrapper",b?"fixed-".concat(b,"--wrapper"):"body--wrapper"],xid:a,onScroll:n},[b?(0,_vue.createCommentVNode)():(0,_vue.h)("div",{ref:h,class:"vxe-body--x-space"}),(0,_vue.h)("table",{ref:m,class:"vxe-table--footer",xid:a,cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("colgroup",{ref:g},T.map(function(e,t){return(0,_vue.h)("col",{name:e.id,key:t})}).concat(r?[(0,_vue.h)("col",{name:"col_gutter"})]:[])),(0,_vue.h)("tfoot",{ref:y},C.map(function(y,h){var w=h;return(0,_vue.h)("tr",{class:["vxe-footer--row",t?_xeUtils.default.isFunction(t)?t({$table:q,_rowIndex:h,$rowIndex:w,fixed:b,type:renderType}):t:""],style:o?_xeUtils.default.isFunction(o)?o({$table:q,_rowIndex:h,$rowIndex:w,fixed:b,type:renderType}):o:null},T.map(function(t,e){var o=t.type,l=t.showFooterOverflow,r=t.footerAlign,n=t.align,a=t.footerClassName,c=A.showAll,i=t.children&&t.children.length,u=b?t.fixed!==b&&!i:t.fixed&&U,s=_xeUtils.default.isUndefined(l)||_xeUtils.default.isNull(l)?O:l,f=r||n||F||L,d="ellipsis"===s,p="title"===s,v=!0===s||"tooltip"===s,i=p||v||d,l={colid:t.id},r={},n=q.getColumnIndex(t),s=q.getVTColumnIndex(t),_={$table:q,_rowIndex:h,$rowIndex:w,column:t,columnIndex:n,$columnIndex:e,_columnIndex:s,itemIndex:s,items:y,fixed:b,type:renderType,data:C};if($&&!i&&(d=i=!0),(p||v||c)&&(r.onMouseenter=function(e){p?(0,_dom.updateCellTitle)(e.currentTarget,t):(v||c)&&q.triggerFooterTooltipEvent(e,_)}),(v||c)&&(r.onMouseleave=function(e){(v||c)&&q.handleTargetLeaveEvent(e)}),r.onClick=function(e){q.dispatchEvent("footer-cell-click",Object.assign({cell:e.currentTarget},_),e)},r.onDblclick=function(e){q.dispatchEvent("footer-cell-dblclick",Object.assign({cell:e.currentTarget},_),e)},j.length){var x=mergeFooterMethod(j,h,s);if(x){var m=x.rowspan,g=x.colspan;if(!m||!g)return null;1<m&&(l.rowspan=m),1<g&&(l.colspan=g)}}else if(D){var s=D(_)||{},x=s.rowspan,m=void 0===x?1:x,s=s.colspan,g=void 0===s?1:s;if(!m||!g)return null;1<m&&(l.rowspan=m),1<g&&(l.colspan=g)}return(0,_vue.h)("td",__assign(__assign(__assign(__assign({class:["vxe-footer--column",t.id,((g={})["col--".concat(f)]=f,g["col--".concat(o)]=o,g["col--last"]=e===T.length-1,g["fixed--hidden"]=u,g["col--ellipsis"]=i,g["col--current"]=k===t,g),(0,_dom.getPropClass)(a,_),(0,_dom.getPropClass)(I,_)]},l),{style:S?_xeUtils.default.isFunction(S)?S(_):S:null}),r),{key:M||E.useKey?t.id:e}),[(0,_vue.h)("div",{class:["vxe-cell",{"c--title":p,"c--tooltip":v,"c--ellipsis":d}]},t.renderFooter(_))])}).concat(r?[(0,_vue.h)("td",{class:"vxe-footer--gutter col--gutter"})]:[]))}))])])}}});exports.default=_default2;