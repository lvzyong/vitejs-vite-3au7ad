"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_vXETable=require("../../v-x-e-table"),_util=require("./util"),_dom=require("../../tools/dom"),_utils=require("../../tools/utils");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __assign=function(){return(__assign=Object.assign||function(e){for(var l,t=1,o=arguments.length;t<o;t++)for(var a in l=arguments[t])Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);return e}).apply(this,arguments)},__spreadArray=function(e,l,t){if(t||2===arguments.length)for(var o,a=0,r=l.length;a<r;a++)!o&&a in l||((o=o||Array.prototype.slice.call(l,0,a))[a]=l[a]);return e.concat(o||Array.prototype.slice.call(l))},renderType="body",lineOffsetSizes={mini:3,small:2,medium:1},_default=(0,_vue.defineComponent)({name:"VxeTableBody",props:{tableData:Array,tableColumn:Array,fixedColumn:Array,fixedType:{type:String,default:null}},setup:function(m){function c(){if(l){var e=l.value;if(e)return lineOffsetSizes[e]||0}return 0}function u(e,l){var t=1;if(!e)return t;var o=e[d.value.children];if(ne.isTreeExpandByRow(e))for(var a=0;a<o.length;a++)t+=u(o[a],l);return t}function re(e){var l=e.row,t=e.column,o=ie.treeConfig,a=d.value,r=t.slots,n=t.treeNode,i=ce.fullAllDataRowIdData[(0,_util.getRowid)(ne,l)],s=0,t=0,l=[];return i&&(s=i.level,t=i._index,l=i.items),r&&r.line?ne.callSlot(r.line,e):o&&n&&a.line?[(0,_vue.h)("div",{class:"vxe-tree--line-wrapper"},[(0,_vue.h)("div",{class:"vxe-tree--line",style:{height:"".concat((n=e,e=l,l=1,(t=t)&&(l=u(e[t-1],n)),se.rowHeight*l-(t?1:12-c())),"px"),left:"".concat(s*a.indent+(s?2-c():0)+16,"px")}})])]:[]}function X(f,h,x){var g=ie.stripe,m=ie.rowKey,_=ie.highlightHoverRow,y=ie.rowClassName,w=ie.rowStyle,b=ie.showOverflow,T=ie.editConfig,S=ie.treeConfig,C=se.hasFixedColumn,O=se.treeExpandeds,L=se.scrollYLoad,R=se.editStore,E=se.rowExpandeds,H=se.expandColumn,I=se.selectRow,D=ce.fullAllDataRowIdData,M=pe.value,$=t.value,k=d.value,q=ue.value,U=he.value,A=k.transform,B=[];return h.forEach(function(t,o){var e={},a=ne.getRowIndex(t);(U.isHover||_)&&(e.onMouseenter=function(e){ge()||ne.triggerHoverEvent(e,{row:t,rowIndex:a})},e.onMouseleave=function(){ge()||ne.clearHoverRow()});var r=(0,_util.getRowid)(ne,t),l=D[r],n=0,i=-1,s=0;l&&(n=l.level,i=l.seq,s=l._index);var c,u,d={$table:ne,seq:i,rowid:r,fixed:f,type:renderType,level:n,row:t,rowIndex:a,$rowIndex:o,_rowIndex:s},v=H&&E.length&&-1<ne.findRowIndexOf(E,t),p=!1,l=!1;T&&(l=-1<ne.findRowIndexOf(R.insertList,t)),S&&!L&&!A&&O.length&&(p=(c=t[k.children])&&c.length&&-1<ne.findRowIndexOf(O,t)),B.push((0,_vue.h)("tr",__assign({class:["vxe-body--row",S?"row--level-".concat(n):"",{"row--stripe":g&&(ne.getVTRowIndex(t)+1)%2==0,"is--new":l,"is--expand-row":v,"is--expand-tree":p,"row--new":l&&(q.showStatus||q.showInsertStatus),"row--radio":$.highlight&&I===t,"row--checked":M.highlight&&ne.isCheckedByCheckboxRow(t)},(0,_dom.getPropClass)(y,d)],rowid:r,style:w?_xeUtils.default.isFunction(w)?w(d):w:null,key:m||U.useKey||S?r:o},e),x.map(function(e,l){return W(i,r,f,n,t,a,o,s,e,l,x,h)}))),v&&(l={},(d=Y.value.height)&&(l.height="".concat(d,"px")),S&&(l.paddingLeft="".concat(n*k.indent+30,"px")),u=H.showOverflow,v=_xeUtils.default.isUndefined(u)||_xeUtils.default.isNull(u)?b:u,u={$table:ne,seq:i,column:H,fixed:f,type:renderType,level:n,row:t,rowIndex:a,$rowIndex:o,_rowIndex:s},B.push((0,_vue.h)("tr",__assign({class:"vxe-body--expanded-row",key:"expand_".concat(r),style:w?_xeUtils.default.isFunction(w)?w(u):w:null},e),[(0,_vue.h)("td",{class:{"vxe-body--expanded-column":1,"fixed--hidden":f&&!C,"col--ellipsis":v},colspan:x.length},[(0,_vue.h)("div",{class:{"vxe-body--expanded-cell":1,"is--ellipsis":d},style:l},[H.renderData(u)])])]))),!S||L||A||!O.length||(u=t[k.children])&&u.length&&-1<ne.findRowIndexOf(O,t)&&B.push.apply(B,X(f,u,x))}),B}function _(e,l,t,o){(t||o)&&(t&&((0,_util.removeScrollListener)(t),t.scrollTop=l),o&&((0,_util.removeScrollListener)(o),o.scrollTop=l),clearTimeout(a),a=setTimeout(function(){(0,_util.restoreScrollListener)(t),(0,_util.restoreScrollListener)(o)},300))}function o(e){var l=m.fixedType,t=ie.highlightHoverRow,o=se.scrollXLoad,a=se.scrollYLoad,r=ce.elemStore,n=ce.lastScrollTop,i=ce.lastScrollLeft,s=he.value,c=b.value,u=T.value,d=S.value,v=C.value,p=O.value,f=L.value,h=I.value,x=c?c.$el:null,g=d?d.$el:null,c=u.$el,d=v?v.$el:null,u=p?p.$el:null,p=(v=r["main-body-ySpace"])?v.value:null,r=(v=r["main-body-xSpace"])?v.value:null,v=(a&&p?p:c).clientHeight,p=(o&&r?r:c).clientWidth,r=h.scrollTop,i=(h=c.scrollLeft)!==i,n=r!==n;ce.lastScrollTop=r,ce.lastScrollLeft=h,ce.lastScrollTime=Date.now(),(s.isHover||t)&&ne.clearHoverRow(),d&&"left"===l?(r=d.scrollTop,_(0,r,c,u)):u&&"right"===l?(r=u.scrollTop,_(0,r,c,d)):(i&&(x&&(x.scrollLeft=c.scrollLeft),g&&(g.scrollLeft=c.scrollLeft)),(d||u)&&(ne.checkScrolling(),n&&_(0,r,d,u))),o&&i&&ne.triggerScrollXEvent(e),a&&n&&ne.triggerScrollYEvent(e),i&&f&&f.reactData.visible&&f.updatePlacement(),ne.dispatchEvent("scroll",{type:renderType,fixed:l,scrollTop:r,scrollLeft:h,scrollHeight:c.scrollHeight,scrollWidth:c.scrollWidth,bodyHeight:v,bodyWidth:p,isX:i,isY:n},e)}function g(e){var l=e.deltaY,t=e.deltaX,o=ie.highlightHoverRow,a=se.scrollYLoad,r=ce.lastScrollTop,n=ce.lastScrollLeft,i=he.value,s=T.value,c=I.value,u=s.$el;((l=(s=l)<0)?c.scrollTop<=0:c.scrollTop>=c.scrollHeight-c.clientHeight)||(c=c.scrollTop+s,n=(t=u.scrollLeft+t)!==n,(r=c!==r)&&(e.preventDefault(),ce.lastScrollTop=c,ce.lastScrollLeft=t,ce.lastScrollTime=Date.now(),(i.isHover||o)&&ne.clearHoverRow(),v(e,l,s,n,r),a&&ne.triggerScrollYEvent(e)))}var a,x,ne=(0,_vue.inject)("$xetable",{}),l=(0,_vue.inject)("xesize",null),y=ne.xID,ie=ne.props,w=ne.context,se=ne.reactData,ce=ne.internalData,e=ne.getRefMaps(),b=e.refTableHeader,T=e.refTableBody,S=e.refTableFooter,C=e.refTableLeftBody,O=e.refTableRightBody,L=e.refValidTooltip,e=ne.getComputeMaps(),ue=e.computeEditOpts,R=e.computeMouseOpts,de=e.computeSYOpts,E=e.computeEmptyOpts,H=e.computeKeyboardOpts,ve=e.computeTooltipOpts,t=e.computeRadioOpts,Y=e.computeExpandOpts,d=e.computeTreeOpts,pe=e.computeCheckboxOpts,fe=e.computeValidOpts,he=e.computeRowOpts,xe=e.computeColumnOpts,I=(0,_vue.ref)(),D=(0,_vue.ref)(),M=(0,_vue.ref)(),$=(0,_vue.ref)(),k=(0,_vue.ref)(),q=(0,_vue.ref)(),U=(0,_vue.ref)(),ge=function(){var e=ie.delayHover,l=ce.lastScrollTime;return ce._isResize||l&&Date.now()<l+e},W=function(e,l,t,o,a,r,n,i,s,c,u,d){var v,p=ie.columnKey,f=ie.height,h=ie.showOverflow,x=ie.cellClassName,g=ie.cellStyle,m=ie.align,_=ie.spanMethod,y=ie.mouseConfig,w=ie.editConfig,b=ie.editRules,T=ie.tooltipConfig,S=se.tableData,C=se.overflowX,O=se.scrollYLoad,L=se.currentColumn,R=se.mergeList,E=se.editStore,H=se.validStore,I=se.isAllOverflow,D=ce.afterFullData,M=fe.value,$=pe.value,k=ue.value,q=ve.value,U=he.value,A=de.value,B=xe.value,X=s.type,Y=s.cellRender,W=s.editRender,N=s.align,j=s.showOverflow,V=s.className,P=s.treeNode,F=E.actived,K=A.rHeight,z=U.height,G=W||Y,J=G?_vXETable.VXETable.renderer.get(G.name):null,E=J?J.cellClassName:"",Q=q.showAll,A=ne.getColumnIndex(s),U=ne.getVTColumnIndex(s),G=(0,_utils.isEnableConf)(W),J=t?s.fixed!==t:s.fixed&&C,q=_xeUtils.default.isUndefined(j)||_xeUtils.default.isNull(j)?h:j,C="ellipsis"===q,Z="title"===q,ee=!0===q||"tooltip"===q,j=Z||ee||C,q={},N=N||m,m=H.row===a&&H.column===s,f=b&&M.showMessage&&("default"===M.message?f||1<S.length:"inline"===M.message),M={colid:s.id},le={$table:ne,seq:e,rowid:l,row:a,rowIndex:r,$rowIndex:n,_rowIndex:i,column:s,columnIndex:A,$columnIndex:c,_columnIndex:U,fixed:t,type:renderType,isHidden:J,level:o,visibleData:D,data:S,items:d};if(O&&!j&&(C=j=!0),(Z||ee||Q||T)&&(q.onMouseenter=function(e){ge()||(Z?(0,_dom.updateCellTitle)(e.currentTarget,s):(ee||Q)&&ne.triggerBodyTooltipEvent(e,le),ne.dispatchEvent("cell-mouseenter",Object.assign({cell:e.currentTarget},le),e))}),(ee||Q||T)&&(q.onMouseleave=function(e){ge()||((ee||Q)&&ne.handleTargetLeaveEvent(e),ne.dispatchEvent("cell-mouseleave",Object.assign({cell:e.currentTarget},le),e))}),($.range||y)&&(q.onMousedown=function(e){ne.triggerCellMousedownEvent(e,le)}),q.onClick=function(e){ne.triggerCellClickEvent(e,le)},q.onDblclick=function(e){ne.triggerCellDblclickEvent(e,le)},R.length){var te=(0,_util.mergeBodyMethod)(R,i,U);if(te){var oe=te.rowspan,ae=te.colspan;if(!oe||!ae)return null;1<oe&&(M.rowspan=oe),1<ae&&(M.colspan=ae)}}else if(_){te=_(le)||{},_=te.rowspan,oe=void 0===_?1:_,te=te.colspan,ae=void 0===te?1:te;if(!oe||!ae)return null;1<oe&&(M.rowspan=oe),1<ae&&(M.colspan=ae)}!(J=J&&R&&(1<M.colspan||1<M.rowspan)?!1:J)&&w&&(W||Y)&&(k.showStatus||k.showUpdateStatus)&&(v=ne.isUpdateByRow(a,s.field));Y=[];return J&&h&&I?Y.push((0,_vue.h)("div",{class:["vxe-cell",{"c--title":Z,"c--tooltip":ee,"c--ellipsis":C}],style:{maxHeight:j&&(K||z)?"".concat(K||z,"px"):""}})):(Y.push.apply(Y,__spreadArray(__spreadArray([],re(le),!1),[(0,_vue.h)("div",{class:["vxe-cell",{"c--title":Z,"c--tooltip":ee,"c--ellipsis":C}],style:{maxHeight:j&&(K||z)?"".concat(K||z,"px"):""},title:Z?ne.getCellLabel(a,s):null},s.renderCell(le))],!1)),f&&m&&Y.push((0,_vue.h)("div",{class:"vxe-cell--valid",style:H.rule&&H.rule.maxWidth?{width:"".concat(H.rule.maxWidth,"px")}:null},[(0,_vue.h)("span",{class:"vxe-cell--valid-msg"},H.content)]))),(0,_vue.h)("td",__assign(__assign(__assign({class:["vxe-body--column",s.id,((H={})["col--".concat(N)]=N,H["col--".concat(X)]=X,H["col--last"]=c===u.length-1,H["col--tree-node"]=P,H["col--edit"]=G,H["col--ellipsis"]=j,H["fixed--hidden"]=J,H["col--dirty"]=v,H["col--actived"]=w&&G&&F.row===a&&(F.column===s||"row"===k.mode),H["col--valid-error"]=m,H["col--current"]=L===s,H),(0,_dom.getPropClass)(E,le),(0,_dom.getPropClass)(V,le),(0,_dom.getPropClass)(x,le)],key:p||B.useKey?s.id:c},M),{style:Object.assign({height:j&&(K||z)?"".concat(K||z,"px"):""},g?_xeUtils.default.isFunction(g)?g(le):g:null)}),q),Y)},A=0,B=0,N=0,j=!1,v=function(r,n,e,i,s){var l=ce.elemStore,t=se.scrollXLoad,o=se.scrollYLoad,a=T.value,c=C.value,u=O.value,d=c?c.$el:null,v=u?u.$el:null,p=a.$el,a=l["main-body-ySpace"],a=a?a.value:null,l=l["main-body-xSpace"],l=l?l.value:null,f=(o&&a?a:p).clientHeight,h=(t&&l?l:p).clientWidth,l=j===n?Math.max(0,A-N):0;j=n,A=Math.abs(n?e-l:e+l),N=B=0,clearTimeout(x),function e(){var l,t,o,a;N<A&&(l=m.fixedType,B=Math.max(5,Math.floor(1.5*B)),A<(N+=B)&&(B-=N-A),a=p.scrollTop,t=p.clientHeight,o=p.scrollHeight,a=a+B*(n?-1:1),p.scrollTop=a,d&&(d.scrollTop=a),v&&(v.scrollTop=a),(n?a<o-t:0<=a)&&(x=setTimeout(e,10)),ne.dispatchEvent("scroll",{type:renderType,fixed:l,scrollTop:p.scrollTop,scrollLeft:p.scrollLeft,scrollHeight:p.scrollHeight,scrollWidth:p.scrollWidth,bodyHeight:f,bodyWidth:h,isX:i,isY:s},r))}()};(0,_vue.onMounted)(function(){(0,_vue.nextTick)(function(){var e=m.fixedType,l=ce.elemStore,t="".concat(e||"main","-body-"),e=I.value;l["".concat(t,"wrapper")]=I,l["".concat(t,"table")]=D,l["".concat(t,"colgroup")]=M,l["".concat(t,"list")]=$,l["".concat(t,"xSpace")]=k,l["".concat(t,"ySpace")]=q,l["".concat(t,"emptyBlock")]=U,e.onscroll=o,e._onscroll=o})}),(0,_vue.onBeforeUnmount)(function(){var e=I.value;clearTimeout(x),e._onscroll=null,e.onscroll=null}),(0,_vue.onUnmounted)(function(){var e=m.fixedType,l=ce.elemStore,e="".concat(e||"main","-body-");l["".concat(e,"wrapper")]=null,l["".concat(e,"table")]=null,l["".concat(e,"colgroup")]=null,l["".concat(e,"list")]=null,l["".concat(e,"xSpace")]=null,l["".concat(e,"ySpace")]=null,l["".concat(e,"emptyBlock")]=null});return function(){var e=m.fixedColumn,l=m.fixedType,t=m.tableColumn,o=ie.keyboardConfig,a=ie.showOverflow,r=ie.spanMethod,n=ie.mouseConfig,i=se.tableData,s=se.mergeList,c=se.scrollYLoad,u=se.isAllOverflow,d=ce.visibleColumn,v=w.slots,p=de.value,f=E.value,h=H.value,x=R.value;return l&&(t=!(c||a&&u)||s.length||r||o&&h.isMerge?d:e),f=v.empty?ne.callSlot(v.empty,{$table:ne}):(v=(v=f.name?_vXETable.VXETable.renderer.get(f.name):null)?v.renderEmpty:null)?v(f,{$table:ne}):ie.emptyText||_conf.default.i18n("vxe.table.emptyText"),(0,_vue.h)("div",__assign({ref:I,class:["vxe-table--body-wrapper",l?"fixed-".concat(l,"--wrapper"):"body--wrapper"],xid:y},"wheel"===p.mode?{onWheel:g}:{}),[l?(0,_vue.createCommentVNode)():(0,_vue.h)("div",{ref:k,class:"vxe-body--x-space"}),(0,_vue.h)("div",{ref:q,class:"vxe-body--y-space"}),(0,_vue.h)("table",{ref:D,class:"vxe-table--body",xid:y,cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("colgroup",{ref:M},t.map(function(e,l){return(0,_vue.h)("col",{name:e.id,key:l})})),(0,_vue.h)("tbody",{ref:$},X(l,i,t))]),(0,_vue.h)("div",{class:"vxe-table--checkbox-range"}),n&&x.area?(0,_vue.h)("div",{class:"vxe-table--cell-area"},[(0,_vue.h)("span",{class:"vxe-table--cell-main-area"},x.extension?[(0,_vue.h)("span",{class:"vxe-table--cell-main-area-btn",onMousedown:function(e){ne.triggerCellExtendMousedownEvent(e,{$table:ne,fixed:l,type:renderType})}})]:[]),(0,_vue.h)("span",{class:"vxe-table--cell-copy-area"}),(0,_vue.h)("span",{class:"vxe-table--cell-extend-area"}),(0,_vue.h)("span",{class:"vxe-table--cell-multi-area"}),(0,_vue.h)("span",{class:"vxe-table--cell-active-area"})]):null,l?null:(0,_vue.h)("div",{class:"vxe-table--empty-block",ref:U},[(0,_vue.h)("div",{class:"vxe-table--empty-content"},f)])])}}});exports.default=_default;