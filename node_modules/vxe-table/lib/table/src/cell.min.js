"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.Cell=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_vXETable=require("../../v-x-e-table"),_utils=require("../../tools/utils"),_dom=require("../../tools/dom"),_util=require("./util"),_vn=require("../../tools/vn");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __assign=function(){return(__assign=Object.assign||function(e){for(var l,r=1,n=arguments.length;r<n;r++)for(var t in l=arguments[r])Object.prototype.hasOwnProperty.call(l,t)&&(e[t]=l[t]);return e}).apply(this,arguments)};function renderHelpIcon(l){var r=l.$table,e=l.column,e=e.titlePrefix||e.titleHelp;return e?[(0,_vue.h)("i",{class:["vxe-cell-help-icon",e.icon||_conf.default.icon.TABLE_HELP],onMouseenter:function(e){r.triggerHeaderHelpEvent(e,l)},onMouseleave:function(e){r.handleTargetLeaveEvent(e)}})]:[]}function renderTitleContent(l,e){var r=l.$table,n=l.column,t=r.props,o=r.internalData,a=r.getComputeMaps().computeTooltipOpts,i=t.showHeaderOverflow,d=n.type,t=n.showHeaderOverflow,c=a.value.showAll,t=_xeUtils.default.isUndefined(t)||_xeUtils.default.isNull(t)?i:t,u="title"===t,s=!0===t||"tooltip"===t,t={};return(u||s||c)&&(t.onMouseenter=function(e){o._isResize||(u?(0,_dom.updateCellTitle)(e.currentTarget,n):(s||c)&&r.triggerHeaderTooltipEvent(e,l))}),(s||c)&&(t.onMouseleave=function(e){o._isResize||(s||c)&&r.handleTargetLeaveEvent(e)}),["html"===d&&_xeUtils.default.isString(e)?(0,_vue.h)("span",__assign({class:"vxe-cell--title",innerHTML:e},t)):(0,_vue.h)("span",__assign({class:"vxe-cell--title"},t),e)]}function getFooterContent(e){var l=e.$table,r=e.column,n=e._columnIndex,t=e.items,o=r.slots,a=r.editRender,r=r.cellRender,r=a||r,o=o?o.footer:null;if(o)return l.callSlot(o,e);if(r){o=_vXETable.VXETable.renderer.get(r.name);if(o&&o.renderFooter)return(0,_vn.getSlotVNs)(o.renderFooter(r,e))}return[(0,_utils.formatText)(t[n],1)]}function getDefaultCellLabel(e){var l=e.$table,r=e.row,e=e.column;return(0,_utils.formatText)(l.getCellLabel(r,e),1)}var Cell={createColumn:function(e,l){var r=l.type,n=l.sortable,t=l.filters,o=l.editRender,a=l.treeNode,i=e.props.editConfig,d=e.getComputeMaps(),c=d.computeEditOpts,u=d.computeCheckboxOpts.value,s=c.value,f={renderHeader:Cell.renderDefaultHeader,renderCell:a?Cell.renderTreeCell:Cell.renderDefaultCell,renderFooter:Cell.renderDefaultFooter};switch(r){case"seq":f.renderHeader=Cell.renderSeqHeader,f.renderCell=a?Cell.renderTreeIndexCell:Cell.renderSeqCell;break;case"radio":f.renderHeader=Cell.renderRadioHeader,f.renderCell=a?Cell.renderTreeRadioCell:Cell.renderRadioCell;break;case"checkbox":f.renderHeader=Cell.renderCheckboxHeader,f.renderCell=u.checkField?a?Cell.renderTreeSelectionCellByProp:Cell.renderCheckboxCellByProp:a?Cell.renderTreeSelectionCell:Cell.renderCheckboxCell;break;case"expand":f.renderCell=Cell.renderExpandCell,f.renderData=Cell.renderExpandData;break;case"html":f.renderCell=a?Cell.renderTreeHTMLCell:Cell.renderHTMLCell,t&&n?f.renderHeader=Cell.renderSortAndFilterHeader:n?f.renderHeader=Cell.renderSortHeader:t&&(f.renderHeader=Cell.renderFilterHeader);break;default:i&&o?(f.renderHeader=Cell.renderEditHeader,f.renderCell="cell"===s.mode?a?Cell.renderTreeCellEdit:Cell.renderCellEdit:a?Cell.renderTreeRowEdit:Cell.renderRowEdit):t&&n?f.renderHeader=Cell.renderSortAndFilterHeader:n?f.renderHeader=Cell.renderSortHeader:t&&(f.renderHeader=Cell.renderFilterHeader)}return(0,_util.createColumn)(e,l,f)},renderHeaderTitle:function(e){var l=e.$table,r=e.column,n=r.slots,t=r.editRender,o=r.cellRender,o=t||o,n=n?n.header:null;if(n)return renderTitleContent(e,l.callSlot(n,e));if(o){n=_vXETable.VXETable.renderer.get(o.name);if(n&&n.renderHeader)return renderTitleContent(e,(0,_vn.getSlotVNs)(n.renderHeader(o,e)))}return renderTitleContent(e,[(0,_utils.formatText)(r.getTitle(),1)])},renderDefaultHeader:function(e){return renderHelpIcon(e).concat(Cell.renderHeaderTitle(e))},renderDefaultCell:function(e){var l=e.$table,r=e.row,n=e.column,t=n.slots,o=n.editRender,a=n.cellRender,i=o||a,a=t?t.default:null;if(a)return l.callSlot(a,e);if(i){t=o?"renderCell":"renderDefault",a=_vXETable.VXETable.renderer.get(i.name),t=a?a[t]:null;if(t)return(0,_vn.getSlotVNs)(t(i,Object.assign({$type:o?"edit":"cell"},e)))}r=l.getCellLabel(r,n),n=o?o.placeholder:"";return[(0,_vue.h)("span",{class:"vxe-cell--label"},o&&(0,_utils.eqEmptyValue)(r)?[(0,_vue.h)("span",{class:"vxe-cell--placeholder"},(0,_utils.formatText)((0,_utils.getFuncText)(n),1))]:(0,_utils.formatText)(r,1))]},renderTreeCell:function(e){return Cell.renderTreeIcon(e,Cell.renderDefaultCell(e))},renderDefaultFooter:function(e){return[(0,_vue.h)("span",{class:"vxe-cell--item"},getFooterContent(e))]},renderTreeIcon:function(l,e){var r=l.$table,n=l.isHidden,t=r.reactData,o=r.getComputeMaps().computeTreeOpts,a=t.treeExpandeds,i=t.treeLazyLoadeds,d=o.value,c=l.row,u=l.column,s=l.level,f=u.slots,C=d.children,_=d.hasChild,v=d.indent,p=d.lazy,E=d.trigger,h=d.iconLoaded,b=d.showIcon,x=d.iconOpen,T=d.iconClose,t=c[C],o=f?f.icon:null,u=!1,d=!1,C=!1,f={};return o?r.callSlot(o,l):(n||(d=-1<r.findRowIndexOf(a,c),p&&(C=-1<r.findRowIndexOf(i,c),u=c[_])),E&&"default"!==E||(f.onClick=function(e){return r.triggerTreeExpandEvent(e,l)}),[(0,_vue.h)("div",{class:["vxe-cell--tree-node",{"is--active":d}],style:{paddingLeft:"".concat(s*v,"px")}},[b&&(t&&t.length||u)?[(0,_vue.h)("div",__assign({class:"vxe-tree--btn-wrapper"},f),[(0,_vue.h)("i",{class:["vxe-tree--node-btn",C?h||_conf.default.icon.TABLE_TREE_LOADED:d?x||_conf.default.icon.TABLE_TREE_OPEN:T||_conf.default.icon.TABLE_TREE_CLOSE]})])]:null,(0,_vue.h)("div",{class:"vxe-tree-cell"},e)])])},renderSeqHeader:function(e){var l=e.$table,r=e.column,n=r.slots,n=n?n.header:null;return renderTitleContent(e,n?l.callSlot(n,e):[(0,_utils.formatText)(r.getTitle(),1)])},renderSeqCell:function(e){var l=e.$table,r=e.column,n=l.props.treeConfig,t=l.getComputeMaps().computeSeqOpts.value,r=r.slots,r=r?r.default:null;if(r)return l.callSlot(r,e);l=e.seq,r=t.seqMethod;return[(0,_utils.formatText)(r?r(e):n?l:(t.startIndex||0)+l,1)]},renderTreeIndexCell:function(e){return Cell.renderTreeIcon(e,Cell.renderSeqCell(e))},renderRadioHeader:function(e){var l=e.$table,r=e.column,n=r.slots,t=n?n.header:null,n=n?n.title:null;return renderTitleContent(e,t?l.callSlot(t,e):[(0,_vue.h)("span",{class:"vxe-radio--label"},n?l.callSlot(n,e):(0,_utils.formatText)(r.getTitle(),1))])},renderRadioCell:function(l){var e,r=l.$table,n=l.column,t=l.isHidden,o=r.reactData,a=r.getComputeMaps().computeRadioOpts,i=o.selectRow,d=a.value,c=n.slots,u=d.labelField,o=d.checkMethod,a=d.visibleMethod,n=l.row,d=c?c.default:null,c=c?c.radio:null,i=n===i,s=!a||a({row:n}),f=!!o;t||(e={onClick:function(e){!f&&s&&r.triggerRadioRowEvent(e,l)}},o&&(f=!o({row:n})));o=__assign(__assign({},l),{checked:i,disabled:f,visible:s});if(c)return r.callSlot(c,o);c=[];return s&&c.push((0,_vue.h)("span",{class:["vxe-radio--icon",i?_conf.default.icon.TABLE_RADIO_CHECKED:_conf.default.icon.TABLE_RADIO_UNCHECKED]})),(d||u)&&c.push((0,_vue.h)("span",{class:"vxe-radio--label"},d?r.callSlot(d,o):_xeUtils.default.get(n,u))),[(0,_vue.h)("span",__assign({class:["vxe-cell--radio",{"is--checked":i,"is--disabled":f}]},e),c)]},renderTreeRadioCell:function(e){return Cell.renderTreeIcon(e,Cell.renderRadioCell(e))},renderCheckboxHeader:function(e){var l,r=e.$table,n=e.column,t=e.isHidden,o=r.reactData,a=r.getComputeMaps(),i=a.computeIsAllCheckboxDisabled,d=a.computeCheckboxOpts,c=o.isAllSelected,a=o.isIndeterminate,u=i.value,o=n.slots,i=o?o.header:null,o=o?o.title:null,d=d.value,n=n.getTitle();t||(l={onClick:function(e){u||r.triggerCheckAllEvent(e,!c)}});e=__assign(__assign({},e),{checked:c,disabled:u,indeterminate:a});return i?renderTitleContent(e,r.callSlot(i,e)):(d.checkStrictly?d.showHeader:!1!==d.showHeader)?renderTitleContent(e,[(0,_vue.h)("span",__assign({class:["vxe-cell--checkbox",{"is--checked":c,"is--disabled":u,"is--indeterminate":a}],title:_conf.default.i18n("vxe.table.allTitle")},l),[(0,_vue.h)("span",{class:["vxe-checkbox--icon",a?_conf.default.icon.TABLE_CHECKBOX_INDETERMINATE:c?_conf.default.icon.TABLE_CHECKBOX_CHECKED:_conf.default.icon.TABLE_CHECKBOX_UNCHECKED]})].concat(o||n?[(0,_vue.h)("span",{class:"vxe-checkbox--label"},o?r.callSlot(o,e):n)]:[]))]):renderTitleContent(e,[(0,_vue.h)("span",{class:"vxe-checkbox--label"},o?r.callSlot(o,e):n)])},renderCheckboxCell:function(l){var e,r=l.$table,n=l.row,t=l.column,o=l.isHidden,a=r.props,i=r.reactData,d=a.treeConfig,c=i.selection,u=i.treeIndeterminates,s=r.getComputeMaps().computeCheckboxOpts.value,f=s.labelField,C=s.checkMethod,a=s.visibleMethod,i=t.slots,s=i?i.default:null,t=i?i.checkbox:null,i=!1,_=!1,v=!a||a({row:n}),p=!!C;o||(_=-1<r.findRowIndexOf(c,n),e={onClick:function(e){!p&&v&&r.triggerCheckRowEvent(e,l,!_)}},C&&(p=!C({row:n})),d&&(i=-1<r.findRowIndexOf(u,n)));u=__assign(__assign({},l),{checked:_,disabled:p,visible:v,indeterminate:i});if(t)return r.callSlot(t,u);t=[];return v&&t.push((0,_vue.h)("span",{class:["vxe-checkbox--icon",i?_conf.default.icon.TABLE_CHECKBOX_INDETERMINATE:_?_conf.default.icon.TABLE_CHECKBOX_CHECKED:_conf.default.icon.TABLE_CHECKBOX_UNCHECKED]})),(s||f)&&t.push((0,_vue.h)("span",{class:"vxe-checkbox--label"},s?r.callSlot(s,u):_xeUtils.default.get(n,f))),[(0,_vue.h)("span",__assign({class:["vxe-cell--checkbox",{"is--checked":_,"is--disabled":p,"is--indeterminate":i}]},e),t)]},renderTreeSelectionCell:function(e){return Cell.renderTreeIcon(e,Cell.renderCheckboxCell(e))},renderCheckboxCellByProp:function(l){var e,r=l.$table,n=l.row,t=l.column,o=l.isHidden,a=r.props,i=r.reactData,d=a.treeConfig,c=i.treeIndeterminates,u=r.getComputeMaps().computeCheckboxOpts.value,s=u.labelField,f=u.checkField,C=u.halfField,_=u.checkMethod,a=u.visibleMethod,i=t.slots,u=i?i.default:null,t=i?i.checkbox:null,i=!1,v=!1,p=!a||a({row:n}),E=!!_;o||(v=_xeUtils.default.get(n,f),e={onClick:function(e){!E&&p&&r.triggerCheckRowEvent(e,l,!v)}},_&&(E=!_({row:n})),d&&(i=-1<r.findRowIndexOf(c,n)));c=__assign(__assign({},l),{checked:v,disabled:E,visible:p,indeterminate:i});if(t)return r.callSlot(t,c);t=[];return p&&(t.push((0,_vue.h)("span",{class:["vxe-checkbox--icon",i?_conf.default.icon.TABLE_CHECKBOX_INDETERMINATE:v?_conf.default.icon.TABLE_CHECKBOX_CHECKED:_conf.default.icon.TABLE_CHECKBOX_UNCHECKED]})),(u||s)&&t.push((0,_vue.h)("span",{class:"vxe-checkbox--label"},u?r.callSlot(u,c):_xeUtils.default.get(n,s)))),[(0,_vue.h)("span",__assign({class:["vxe-cell--checkbox",{"is--checked":v,"is--disabled":E,"is--indeterminate":C&&!v?n[C]:i}]},e),t)]},renderTreeSelectionCellByProp:function(e){return Cell.renderTreeIcon(e,Cell.renderCheckboxCellByProp(e))},renderExpandCell:function(l){var r=l.$table,e=l.isHidden,n=l.row,t=l.column,o=r.reactData,a=o.rowExpandeds,i=o.expandLazyLoadeds,d=r.getComputeMaps().computeExpandOpts.value,c=d.lazy,u=d.labelField,s=d.iconLoaded,f=d.showIcon,C=d.iconOpen,_=d.iconClose,v=d.visibleMethod,p=t.slots,o=p?p.default:null,d=p?p.icon:null,t=!1,p=!1;return d?r.callSlot(d,l):(e||(t=-1<r.findRowIndexOf(a,l.row),c&&(p=-1<r.findRowIndexOf(i,n))),[!f||v&&!v(l)?null:(0,_vue.h)("span",{class:["vxe-table--expanded",{"is--active":t}],onClick:function(e){r.triggerRowExpandEvent(e,l)}},[(0,_vue.h)("i",{class:["vxe-table--expand-btn",p?s||_conf.default.icon.TABLE_EXPAND_LOADED:t?C||_conf.default.icon.TABLE_EXPAND_OPEN:_||_conf.default.icon.TABLE_EXPAND_CLOSE]})]),o||u?(0,_vue.h)("span",{class:"vxe-table--expand-label"},o?r.callSlot(o,l):_xeUtils.default.get(n,u)):null])},renderExpandData:function(e){var l=e.$table,r=e.column,n=r.slots,r=r.contentRender,n=n?n.content:null;if(n)return l.callSlot(n,e);if(r){n=_vXETable.VXETable.renderer.get(r.name);if(n&&n.renderExpand)return(0,_vn.getSlotVNs)(n.renderExpand(r,e))}return[]},renderHTMLCell:function(e){var l=e.$table,r=e.column.slots,r=r?r.default:null;return r?l.callSlot(r,e):[(0,_vue.h)("span",{class:"vxe-cell--html",innerHTML:getDefaultCellLabel(e)})]},renderTreeHTMLCell:function(e){return Cell.renderTreeIcon(e,Cell.renderHTMLCell(e))},renderSortAndFilterHeader:function(e){return Cell.renderDefaultHeader(e).concat(Cell.renderSortIcon(e)).concat(Cell.renderFilterIcon(e))},renderSortHeader:function(e){return Cell.renderDefaultHeader(e).concat(Cell.renderSortIcon(e))},renderSortIcon:function(e){var l=e.$table,r=e.column,n=l.getComputeMaps().computeSortOpts.value,t=n.showIcon,o=n.iconAsc,e=n.iconDesc,n=r.order;return t?[(0,_vue.h)("span",{class:"vxe-cell--sort"},[(0,_vue.h)("i",{class:["vxe-sort--asc-btn",o||_conf.default.icon.TABLE_SORT_ASC,{"sort--active":"asc"===n}],title:_conf.default.i18n("vxe.table.sortAsc"),onClick:function(e){l.triggerSortEvent(e,r,"asc")}}),(0,_vue.h)("i",{class:["vxe-sort--desc-btn",e||_conf.default.icon.TABLE_SORT_DESC,{"sort--active":"desc"===n}],title:_conf.default.i18n("vxe.table.sortDesc"),onClick:function(e){l.triggerSortEvent(e,r,"desc")}})])]:[]},renderFilterHeader:function(e){return Cell.renderDefaultHeader(e).concat(Cell.renderFilterIcon(e))},renderFilterIcon:function(l){var r=l.$table,e=l.column,n=l.hasFilter,t=r.reactData.filterStore,o=r.getComputeMaps().computeFilterOpts.value,a=o.showIcon,i=o.iconNone,o=o.iconMatch;return a?[(0,_vue.h)("span",{class:["vxe-cell--filter",{"is--active":t.visible&&t.column===e}]},[(0,_vue.h)("i",{class:["vxe-filter--btn",n?o||_conf.default.icon.TABLE_FILTER_MATCH:i||_conf.default.icon.TABLE_FILTER_NONE],title:_conf.default.i18n("vxe.table.filter"),onClick:function(e){r.triggerFilterEvent(e,l.column,l)}})])]:[]},renderEditHeader:function(e){var l=e.$table,r=e.column,n=l.props,t=l.getComputeMaps().computeEditOpts,o=n.editConfig,a=n.editRules,i=t.value,d=r.sortable,l=r.filters,n=r.editRender,t=!1;return!a||(r=_xeUtils.default.get(a,r.field))&&(t=r.some(function(e){return e.required})),((0,_utils.isEnableConf)(o)?[t&&i.showAsterisk?(0,_vue.h)("i",{class:"vxe-cell--required-icon"}):null,(0,_utils.isEnableConf)(n)&&i.showIcon?(0,_vue.h)("i",{class:["vxe-cell--edit-icon",i.icon||_conf.default.icon.TABLE_EDIT]}):null]:[]).concat(Cell.renderDefaultHeader(e)).concat(d?Cell.renderSortIcon(e):[]).concat(l?Cell.renderFilterIcon(e):[])},renderRowEdit:function(e){var l=e.$table,r=e.column,l=l.reactData.editStore.actived,r=r.editRender;return Cell.runRenderer(e,(0,_utils.isEnableConf)(r)&&l&&l.row===e.row)},renderTreeRowEdit:function(e){return Cell.renderTreeIcon(e,Cell.renderRowEdit(e))},renderCellEdit:function(e){var l=e.$table,r=e.column,l=l.reactData.editStore.actived,r=r.editRender;return Cell.runRenderer(e,(0,_utils.isEnableConf)(r)&&l&&l.row===e.row&&l.column===e.column)},renderTreeCellEdit:function(e){return Cell.renderTreeIcon(e,Cell.renderCellEdit(e))},runRenderer:function(e,l){var r=e.$table,n=e.column,t=n.slots,o=n.editRender,a=n.formatter,i=t?t.default:null,n=t?t.edit:null,t=_vXETable.VXETable.renderer.get(o.name);return l?n?r.callSlot(n,e):t&&t.renderEdit?(0,_vn.getSlotVNs)(t.renderEdit(o,Object.assign({$type:"edit"},e))):[]:i?r.callSlot(i,e):a?[(0,_vue.h)("span",{class:"vxe-cell--label"},getDefaultCellLabel(e))]:Cell.renderDefaultCell(e)}},_default=exports.Cell=Cell;exports.default=_default;