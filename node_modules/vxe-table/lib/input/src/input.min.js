"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_size=require("../../hooks/size"),_utils=require("../../tools/utils"),_dom=require("../../tools/dom"),_event=require("../../tools/event"),_date=require("./date"),_number=require("./number");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var yearSize=12,monthSize=20,quarterSize=8,_default2=(0,_vue.defineComponent)({name:"VxeInput",props:{modelValue:[String,Number,Date],immediate:{type:Boolean,default:!0},name:String,type:{type:String,default:"text"},clearable:{type:Boolean,default:function(){return _conf.default.input.clearable}},readonly:Boolean,disabled:Boolean,placeholder:String,maxlength:[String,Number],autocomplete:{type:String,default:"off"},align:String,form:String,className:String,size:{type:String,default:function(){return _conf.default.input.size||_conf.default.size}},multiple:Boolean,min:{type:[String,Number],default:null},max:{type:[String,Number],default:null},step:[String,Number],exponential:{type:Boolean,default:function(){return _conf.default.input.exponential}},controls:{type:Boolean,default:function(){return _conf.default.input.controls}},digits:{type:[String,Number],default:function(){return _conf.default.input.digits}},startDate:{type:[String,Number,Date],default:function(){return _conf.default.input.startDate}},endDate:{type:[String,Number,Date],default:function(){return _conf.default.input.endDate}},minDate:[String,Number,Date],maxDate:[String,Number,Date],startWeek:Number,startDay:{type:[String,Number],default:function(){return _conf.default.input.startDay}},labelFormat:{type:String,default:function(){return _conf.default.input.labelFormat}},valueFormat:{type:String,default:function(){return _conf.default.input.valueFormat}},editable:{type:Boolean,default:!0},festivalMethod:{type:Function,default:function(){return _conf.default.input.festivalMethod}},disabledMethod:{type:Function,default:function(){return _conf.default.input.disabledMethod}},selectDay:{type:[String,Number],default:function(){return _conf.default.input.selectDay}},prefixIcon:String,suffixIcon:String,placement:String,transfer:{type:Boolean,default:function(){return _conf.default.input.transfer}}},emits:["update:modelValue","input","change","keydown","keyup","wheel","click","focus","blur","clear","search-click","toggle-visible","prev-number","next-number","prefix-click","suffix-click","date-prev","date-today","date-next"],setup:function(W,e){function P(e){var t=e.target.value;Be(t,e)}function N(e){Ie.value||Le(e)}function V(e){z.isActivated=!0,Le(e)}function b(e,t){var a=W.type,n=J.value;ee.value&&Qe(),(n||-1<["text","search","password"].indexOf(a))&&focus(),$.dispatchEvent("clear",{value:t},e)}function u(){var e=ee.value,t=z.inputValue;e&&(Ze(t),z.inputValue=W.multiple?ve.value:z.datePanelLabel)}function t(){var e=W.type,t=z.inputValue,a=ee.value,n=ne.value;a?u():"float"===e&&(!t||t!==(n=(0,_number.toFloatValueFixed)(t,n))&&Ge(n,{type:"init"}))}function w(e){var t=z.inputValue;Ie.value||Ge(t,e),nt(),z.visiblePanel||(z.isActivated=!1),$.dispatchEvent("blur",{value:t},e)}function a(e){var t=W.readonly,a=W.disabled,n=z.showPwd;a||t||(z.showPwd=!n),$.dispatchEvent("toggle-visible",{visible:z.showPwd},e)}function n(e){$.dispatchEvent("search-click",{},e)}function l(e,t){var a=W.min,n=W.max,u=W.type,l=z.inputValue,i=ue.value,l="integer"===u?_xeUtils.default.toInteger((0,_number.handleNumber)(l)):_xeUtils.default.toNumber((0,_number.handleNumber)(l)),i=e?_xeUtils.default.add(l,i):_xeUtils.default.subtract(l,i),a=Je(i)?Xe(i)?i:n:a;Be(He(a),t)}function i(e){E=window.setTimeout(function(){ut(e),i(e)},60)}function k(e){var t,a,n,u,l=W.exponential,i=W.controls;J.value&&(t=e.ctrlKey,a=e.shiftKey,n=e.altKey,u=e.keyCode,t||a||n||!((0,_event.hasEventKey)(e,_event.EVENT_KEYS.SPACEBAR)||(!l||69!==u)&&65<=u&&u<=90||186<=u&&u<=188||191<=u)||e.preventDefault(),i&&it(e)),Le(e)}function T(e){Le(e)}function r(){clearTimeout(E)}function s(e){E=window.setTimeout(function(){lt(e),s(e)},60)}function o(e){var t;r(),0===e.button&&(((t=(0,_dom.hasClass)(e.currentTarget,"is--prev"))?lt:ut)(e),E=window.setTimeout(function(){(t?s:i)(e)},500))}function M(e){var t;J.value&&W.controls&&z.isActivated&&(0<(t=e.deltaY)?ut(e):t<0&&lt(e),e.preventDefault()),Le(e)}function c(){var e="month"===(e=z.datePanelType)||"quarter"===e?"year":"month";z.datePanelType=e}function v(e){st(),W.multiple||(at(z.currentDate),Qe()),$.dispatchEvent("date-today",{type:W.type},e)}function Y(e){var t=W.disabledMethod,a=z.datePanelType;return t&&t({type:a,viewType:a,date:e.date,$input:Q})}function U(e){var t=W.type,a=W.multiple,n=z.datePanelType;"month"===t?"year"===n?(z.datePanelType="month",tt(e)):(at(e),a||Qe()):"year"===t?(at(e),a||Qe()):"quarter"===t?"year"===n?(z.datePanelType="quarter",tt(e)):(at(e),a||Qe()):"month"===n?(z.datePanelType="week"===t?t:"day",tt(e)):"year"===n?(z.datePanelType="month",tt(e)):(at(e),a||Qe())}function C(e){Y(e)||U(e.date)}function q(e){var t;Y(e)||("month"===(t=z.datePanelType)?pt:"quarter"===t?ft:"year"===t?dt:vt)(e.date)}function d(e){z.datetimePanelValue=new Date(z.datetimePanelValue.getTime()),_t(e.currentTarget)}function f(){var e=W.multiple,t=fe.value;(X.value||e)&&at(t||z.currentDate),Qe()}function p(){return(0,_vue.nextTick)().then(function(){var e=W.transfer,t=W.placement,a=z.panelIndex,n=L.value,u=G.value;if(n&&u){var l=n.offsetHeight,i=n.offsetWidth,r=u.offsetHeight,s=u.offsetWidth,o={zIndex:a},c=(0,_dom.getAbsolutePos)(n),v=c.boundingTop,u=c.boundingLeft,a=c.visibleHeight,n=c.visibleWidth,c="bottom";return e?(e=v+l,"top"===t?(c="top",e=v-r):t||(a<e+r+5&&(c="top",e=v-r),e<5&&(c="bottom",e=v+l)),n<(u=u)+s+5&&(u-=u+s+5-n),u<5&&(u=5),Object.assign(o,{left:"".concat(u,"px"),top:"".concat(e,"px"),minWidth:"".concat(i,"px")})):"top"===t?(c="top",o.bottom="".concat(l,"px")):t||a<v+l+r&&5<v-l-r&&(c="top",o.bottom="".concat(l,"px")),z.panelStyle=o,z.panelPlacement=c,(0,_vue.nextTick)()}})}function K(e){ee.value&&ht(e),Le(e)}function _(e){var t=W.disabled,a=z.visiblePanel,n=z.isActivated,u=ee.value,l=H.value,i=G.value;!t&&n&&(z.isActivated=(0,_dom.getEventTargetNode)(e,l).flag||(0,_dom.getEventTargetNode)(e,i).flag,z.isActivated||(u?a&&(Qe(),nt()):nt()))}function m(e){var t,a,n,u,l,i,r,s,o,c,v,d,f,p,_,m,h=W.clearable,x=W.disabled,y=z.visiblePanel,g=ee.value;x||(t=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.TAB),a=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.DELETE),n=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ESCAPE),u=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ENTER),m=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_LEFT),l=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_UP),v=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_RIGHT),i=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_DOWN),r=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.PAGE_UP),o=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.PAGE_DOWN),d=m||l||v||i,s=z.isActivated,t?(s&&nt(),z.isActivated=s=!1):d?g&&s&&(y?(c=e,_=z.isActivated,x=z.datePanelValue,m=z.datePanelType,_&&(c.preventDefault(),v=(0,_event.hasEventKey)(c,_event.EVENT_KEYS.ARROW_LEFT),d=(0,_event.hasEventKey)(c,_event.EVENT_KEYS.ARROW_UP),_=(0,_event.hasEventKey)(c,_event.EVENT_KEYS.ARROW_RIGHT),c=(0,_event.hasEventKey)(c,_event.EVENT_KEYS.ARROW_DOWN),"year"===m?(f=_xeUtils.default.getWhatYear(x||Date.now(),0,"first"),v?f=_xeUtils.default.getWhatYear(f,-1):d?f=_xeUtils.default.getWhatYear(f,-4):_?f=_xeUtils.default.getWhatYear(f,1):c&&(f=_xeUtils.default.getWhatYear(f,4)),dt(f)):"quarter"===m?(f=_xeUtils.default.getWhatQuarter(x||Date.now(),0,"first"),v?f=_xeUtils.default.getWhatQuarter(f,-1):d?f=_xeUtils.default.getWhatQuarter(f,-2):_?f=_xeUtils.default.getWhatQuarter(f,1):c&&(f=_xeUtils.default.getWhatQuarter(f,2)),ft(f)):"month"===m?(p=_xeUtils.default.getWhatMonth(x||Date.now(),0,"first"),v?p=_xeUtils.default.getWhatMonth(p,-1):d?p=_xeUtils.default.getWhatMonth(p,-4):_?p=_xeUtils.default.getWhatMonth(p,1):c&&(p=_xeUtils.default.getWhatMonth(p,4)),pt(p)):(p=x||_xeUtils.default.getWhatDay(Date.now(),0,"first"),x=be.value,v?p=_xeUtils.default.getWhatDay(p,-1):d?p=_xeUtils.default.getWhatWeek(p,-1,x):_?p=_xeUtils.default.getWhatDay(p,1):c&&(p=_xeUtils.default.getWhatWeek(p,1,x)),vt(p)))):(l||i)&&ht(e)):u?g&&(y?z.datePanelValue?U(z.datePanelValue):Qe():s&&ht(e)):(r||o)&&g&&s&&(o=e,z.isActivated&&(g=(0,_event.hasEventKey)(o,_event.EVENT_KEYS.PAGE_UP),o.preventDefault(),(g?ot:ct)(o))),t||n?y&&Qe():a&&h&&s&&b(e,null))}function h(e){var t=W.disabled,a=z.visiblePanel;t||a&&(a=G.value,(0,_dom.getEventTargetNode)(e,a).flag?p():(Qe(),nt()))}function x(){var e=z.isActivated;z.visiblePanel?(Qe(),nt()):e&&nt()}function A(e,t){if(n=W.festivalMethod){var a=z.datePanelType,n=n({type:a,viewType:a,date:e.date,$input:Q}),a=n?_xeUtils.default.isString(n)?{label:n}:n:{},e=a.extra?_xeUtils.default.isString(a.extra)?{label:a.extra}:a.extra:null,n=[(0,_vue.h)("span",{class:["vxe-input--date-label",{"is-notice":a.notice}]},e&&e.label?[(0,_vue.h)("span",t),(0,_vue.h)("span",{class:["vxe-input--date-label--extra",e.important?"is-important":"",e.className],style:e.style},_xeUtils.default.toValueString(e.label))]:t)],e=a.label;return e&&(e=_xeUtils.default.toValueString(e).split(","),n.push((0,_vue.h)("span",{class:["vxe-input--date-festival",a.important?"is-important":"",a.className],style:a.style},[1<e.length?(0,_vue.h)("span",{class:["vxe-input--date-festival--overlap","overlap--".concat(e.length)]},e.map(function(e){return(0,_vue.h)("span",e.substring(0,3))})):(0,_vue.h)("span",{class:"vxe-input--date-festival--label"},e[0].substring(0,3))]))),n}return t}function y(){var a,n,u,l,i,r,e,s,o,t,c,v,d,f,p,_,m,h,x,y,g,b,U,E,S,D,P,N,V,w,k,T,M;switch(z.datePanelType){case"week":return h=W.multiple,x=z.datePanelType,y=z.datePanelValue,g=fe.value,b=Se.value,U=Me.value,E=oe.value,S="yyyyMMdd",[(0,_vue.h)("table",{class:"vxe-input--date-".concat(x,"-view"),cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("thead",[(0,_vue.h)("tr",b.map(function(e){return(0,_vue.h)("th",e.label)}))]),(0,_vue.h)("tbody",U.map(function(e){var t=h?e.some(function(t){return E.some(function(e){return _xeUtils.default.isDateSame(e,t.date,S)})}):e.some(function(e){return _xeUtils.default.isDateSame(g,e.date,S)}),a=e.some(function(e){return _xeUtils.default.isDateSame(y,e.date,S)});return(0,_vue.h)("tr",e.map(function(e){return(0,_vue.h)("td",{class:{"is--prev":e.isPrev,"is--current":e.isCurrent,"is--now":e.isNow,"is--next":e.isNext,"is--disabled":Y(e),"is--selected":t,"is--hover":a},onClick:function(){return C(e)},onMouseenter:function(){return q(e)}},A(e,e.label))}))}))])];case"month":return d=W.multiple,b=z.datePanelType,f=z.datePanelValue,p=fe.value,U=we.value,_=oe.value,m="yyyyMM",[(0,_vue.h)("table",{class:"vxe-input--date-".concat(b,"-view"),cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("tbody",U.map(function(e){return(0,_vue.h)("tr",e.map(function(t){return(0,_vue.h)("td",{class:{"is--prev":t.isPrev,"is--current":t.isCurrent,"is--now":t.isNow,"is--next":t.isNext,"is--disabled":Y(t),"is--selected":d?_.some(function(e){return _xeUtils.default.isDateSame(e,t.date,m)}):_xeUtils.default.isDateSame(p,t.date,m),"is--hover":_xeUtils.default.isDateSame(f,t.date,m)},onClick:function(){return C(t)},onMouseenter:function(){return q(t)}},A(t,_conf.default.i18n("vxe.input.date.months.m".concat(t.month))))}))}))])];case"quarter":return r=W.multiple,e=z.datePanelType,s=z.datePanelValue,o=fe.value,t=Ne.value,c=oe.value,v="yyyyq",[(0,_vue.h)("table",{class:"vxe-input--date-".concat(e,"-view"),cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("tbody",t.map(function(e){return(0,_vue.h)("tr",e.map(function(t){return(0,_vue.h)("td",{class:{"is--prev":t.isPrev,"is--current":t.isCurrent,"is--now":t.isNow,"is--next":t.isNext,"is--disabled":Y(t),"is--selected":r?c.some(function(e){return _xeUtils.default.isDateSame(e,t.date,v)}):_xeUtils.default.isDateSame(o,t.date,v),"is--hover":_xeUtils.default.isDateSame(s,t.date,v)},onClick:function(){return C(t)},onMouseenter:function(){return q(t)}},A(t,_conf.default.i18n("vxe.input.date.quarters.q".concat(t.quarter))))}))}))])];case"year":return a=W.multiple,e=z.datePanelType,n=z.datePanelValue,u=fe.value,t=De.value,l=oe.value,i="yyyy",[(0,_vue.h)("table",{class:"vxe-input--date-".concat(e,"-view"),cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("tbody",t.map(function(e){return(0,_vue.h)("tr",e.map(function(t){return(0,_vue.h)("td",{class:{"is--prev":t.isPrev,"is--current":t.isCurrent,"is--now":t.isNow,"is--next":t.isNext,"is--disabled":Y(t),"is--selected":a?l.some(function(e){return _xeUtils.default.isDateSame(e,t.date,i)}):_xeUtils.default.isDateSame(u,t.date,i),"is--hover":_xeUtils.default.isDateSame(n,t.date,i)},onClick:function(){return C(t)},onMouseenter:function(){return q(t)}},A(t,t.year))}))}))])]}return D=W.multiple,P=z.datePanelType,N=z.datePanelValue,V=fe.value,w=Ee.value,k=Te.value,T=oe.value,M="yyyyMMdd",[(0,_vue.h)("table",{class:"vxe-input--date-".concat(P,"-view"),cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("thead",[(0,_vue.h)("tr",w.map(function(e){return(0,_vue.h)("th",e.label)}))]),(0,_vue.h)("tbody",k.map(function(e){return(0,_vue.h)("tr",e.map(function(t){return(0,_vue.h)("td",{class:{"is--prev":t.isPrev,"is--current":t.isCurrent,"is--now":t.isNow,"is--next":t.isNext,"is--disabled":Y(t),"is--selected":D?T.some(function(e){return _xeUtils.default.isDateSame(e,t.date,M)}):_xeUtils.default.isDateSame(V,t.date,M),"is--hover":_xeUtils.default.isDateSame(N,t.date,M)},onClick:function(){return C(t)},onMouseenter:function(){return q(t)}},A(t,t.label))}))}))])]}var g,E,F=e.slots,S=e.emit,D=(0,_vue.inject)("$xeform",null),I=(0,_vue.inject)("$xeformiteminfo",null),R=_xeUtils.default.uniqueId(),O=(0,_size.useSize)(W),z=(0,_vue.reactive)({inited:!1,panelIndex:0,showPwd:!1,visiblePanel:!1,animatVisible:!1,panelStyle:null,panelPlacement:"",isActivated:!1,inputValue:W.modelValue,datetimePanelValue:null,datePanelValue:null,datePanelLabel:"",datePanelType:"day",selectMonth:null,currentDate:null}),H=(0,_vue.ref)(),L=(0,_vue.ref)(),G=(0,_vue.ref)(),B=(0,_vue.ref)(),j={refElem:H,refInput:L},Q={xID:R,props:W,context:e,reactData:z,getRefMaps:function(){return j}},$={},Z=function(e,t){return"time"===W.type?(0,_date.toStringTimeDate)(e):_xeUtils.default.toStringDate(e,t)},X=(0,_vue.computed)(function(){var e=W.type;return"time"===e||"datetime"===e}),J=(0,_vue.computed)(function(){return-1<["number","integer","float"].indexOf(W.type)}),ee=(0,_vue.computed)(function(){return X.value||-1<["date","week","month","quarter","year"].indexOf(W.type)}),te=(0,_vue.computed)(function(){return"password"===W.type}),ae=(0,_vue.computed)(function(){return"search"===W.type}),ne=(0,_vue.computed)(function(){return _xeUtils.default.toInteger(W.digits)||1}),ue=(0,_vue.computed)(function(){var e=W.type,t=ne.value,a=W.step;return"integer"===e?_xeUtils.default.toInteger(a)||1:"float"===e?_xeUtils.default.toNumber(a)||1/Math.pow(10,t):_xeUtils.default.toNumber(a)||1}),le=(0,_vue.computed)(function(){var e=W.type,t=J.value,a=ee.value,n=te.value;return W.clearable&&(n||t||a||"text"===e||"search"===e)}),ie=(0,_vue.computed)(function(){return W.startDate?_xeUtils.default.toStringDate(W.startDate):null}),re=(0,_vue.computed)(function(){return W.endDate?_xeUtils.default.toStringDate(W.endDate):null}),se=(0,_vue.computed)(function(){return["date","week","month","quarter","year"].includes(W.type)}),oe=(0,_vue.computed)(function(){var e=W.modelValue,t=W.multiple,a=ee.value,n=de.value;return t&&e&&a?_xeUtils.default.toValueString(e).split(",").map(function(e){e=Z(e,n);return _xeUtils.default.isValidDate(e)?e:null}):[]}),ce=(0,_vue.computed)(function(){var e=oe.value,t=de.value;return e.map(function(e){return _xeUtils.default.toDateString(e,t)})}),ve=(0,_vue.computed)(function(){var e=oe.value,t=xe.value;return e.map(function(e){return _xeUtils.default.toDateString(e,t)}).join(", ")}),de=(0,_vue.computed)(function(){var e=W.type;return"time"===e?"HH:mm:ss":W.valueFormat||("datetime"===e?"yyyy-MM-dd HH:mm:ss":"yyyy-MM-dd")}),fe=(0,_vue.computed)(function(){var e=W.modelValue,t=ee.value,a=de.value,n=null;return e&&t&&(a=Z(e,a),_xeUtils.default.isValidDate(a)&&(n=a)),n}),pe=(0,_vue.computed)(function(){var e=ie.value,t=z.selectMonth;return!(!t||!e)&&t<=e}),_e=(0,_vue.computed)(function(){var e=re.value,t=z.selectMonth;return!(!t||!e)&&e<=t}),me=(0,_vue.computed)(function(){var e=z.datetimePanelValue;return e?_xeUtils.default.toDateString(e,"HH:mm:ss"):""}),he=(0,_vue.computed)(function(){var e=fe.value,t=X.value;return e&&t?1e3*(3600*e.getHours()+60*e.getMinutes()+e.getSeconds()):0}),xe=(0,_vue.computed)(function(){return ee.value?W.labelFormat||_conf.default.i18n("vxe.input.date.labelFormat.".concat(W.type)):null}),ye=(0,_vue.computed)(function(){var e=z.selectMonth,t=z.currentDate,a=[];if(e&&t)for(var n=t.getFullYear(),e=e.getFullYear(),u=new Date(e-e%yearSize,0,1),l=-4;l<yearSize+4;l++){var i=_xeUtils.default.getWhatYear(u,l,"first"),r=i.getFullYear();a.push({date:i,isCurrent:!0,isPrev:l<0,isNow:n===r,isNext:yearSize<=l,year:r})}return a}),ge=(0,_vue.computed)(function(){if(ee.value){var e=z.datePanelType,t=z.selectMonth,a=ye.value,n="",u=void 0;return t&&(n=t.getFullYear(),u=t.getMonth()+1),"quarter"===e?_conf.default.i18n("vxe.input.date.quarterLabel",[n]):"month"===e?_conf.default.i18n("vxe.input.date.monthLabel",[n]):"year"===e?a.length?"".concat(a[0].year," - ").concat(a[a.length-1].year):"":_conf.default.i18n("vxe.input.date.dayLabel",[n,u?_conf.default.i18n("vxe.input.date.m".concat(u)):"-"])}return""}),be=(0,_vue.computed)(function(){var e=W.startDay,t=W.startWeek;return _xeUtils.default.toNumber(_xeUtils.default.isNumber(e)||_xeUtils.default.isString(e)?e:t)}),Ue=(0,_vue.computed)(function(){var e=[];if(ee.value){var t=be.value;e.push(t);for(var a=0;a<6;a++)6<=t?t=0:t++,e.push(t)}return e}),Ee=(0,_vue.computed)(function(){return ee.value?Ue.value.map(function(e){return{value:e,label:_conf.default.i18n("vxe.input.date.weeks.w".concat(e))}}):[]}),Se=(0,_vue.computed)(function(){if(ee.value){var e=Ee.value;return[{label:_conf.default.i18n("vxe.input.date.weeks.w")}].concat(e)}return[]}),De=(0,_vue.computed)(function(){var e=ye.value;return _xeUtils.default.chunk(e,4)}),Pe=(0,_vue.computed)(function(){var e=z.selectMonth,t=z.currentDate,a=[];if(e&&t)for(var n=t.getFullYear(),u=(0,_date.getDateQuarter)(t),l=_xeUtils.default.getWhatYear(e,0,"first"),i=l.getFullYear(),r=-2;r<quarterSize-2;r++){var s=_xeUtils.default.getWhatQuarter(l,r),o=s.getFullYear(),c=(0,_date.getDateQuarter)(s),v=o<i;a.push({date:s,isPrev:v,isCurrent:o===i,isNow:o===n&&c===u,isNext:!v&&i<o,quarter:c})}return a}),Ne=(0,_vue.computed)(function(){var e=Pe.value;return _xeUtils.default.chunk(e,2)}),Ve=(0,_vue.computed)(function(){var e=z.selectMonth,t=z.currentDate,a=[];if(e&&t)for(var n=t.getFullYear(),u=t.getMonth(),l=_xeUtils.default.getWhatYear(e,0,"first").getFullYear(),i=-4;i<monthSize-4;i++){var r=_xeUtils.default.getWhatYear(e,0,i),s=r.getFullYear(),o=r.getMonth(),c=s<l;a.push({date:r,isPrev:c,isCurrent:s===l,isNow:s===n&&o===u,isNext:!c&&l<s,month:o})}return a}),we=(0,_vue.computed)(function(){var e=Ve.value;return _xeUtils.default.chunk(e,4)}),ke=(0,_vue.computed)(function(){var e=z.selectMonth,t=z.currentDate,a=[];if(e&&t)for(var n=he.value,u=Ue.value,l=t.getFullYear(),i=t.getMonth(),r=t.getDate(),s=e.getFullYear(),o=e.getMonth(),t=e.getDay(),t=-u.indexOf(t),c=new Date(_xeUtils.default.getWhatDay(e,t).getTime()+n),v=0;v<42;v++){var d=_xeUtils.default.getWhatDay(c,v),f=d.getFullYear(),p=d.getMonth(),_=d.getDate(),m=d<e;a.push({date:d,isPrev:m,isCurrent:f===s&&p===o,isNow:f===l&&p===i&&_===r,isNext:!m&&o!==p,label:_})}return a}),Te=(0,_vue.computed)(function(){var e=ke.value;return _xeUtils.default.chunk(e,7)}),Me=(0,_vue.computed)(function(){var e=Te.value,a=be.value;return e.map(function(e){var t=e[0];return[{date:t.date,isWeekNumber:!0,isPrev:!1,isCurrent:!1,isNow:!1,isNext:!1,label:_xeUtils.default.getYearWeek(t.date,a)}].concat(e)})}),We=(0,_vue.computed)(function(){var e=[];if(X.value)for(var t=0;t<24;t++)e.push({value:t,label:(""+t).padStart(2,"0")});return e}),Ye=(0,_vue.computed)(function(){var e=[];if(X.value)for(var t=0;t<60;t++)e.push({value:t,label:(""+t).padStart(2,"0")});return e}),Ce=(0,_vue.computed)(function(){return Ye.value}),qe=(0,_vue.computed)(function(){var e=W.type,t=W.readonly,a=W.editable,n=W.multiple;return t||n||!a||"week"===e||"quarter"===e}),Ke=(0,_vue.computed)(function(){var e=W.type,t=z.showPwd,a=J.value,n=ee.value,u=te.value;return n||a||u&&t||"number"===e?"text":e}),Ae=(0,_vue.computed)(function(){var e=W.placeholder;return e?(0,_utils.getFuncText)(e):""}),Fe=(0,_vue.computed)(function(){var e=W.maxlength;return J.value&&!_xeUtils.default.toNumber(e)?16:e}),Ie=(0,_vue.computed)(function(){var e=W.type;return W.immediate||!("text"===e||"number"===e||"integer"===e||"float"===e)}),Re=(0,_vue.computed)(function(){var e=W.type,t=z.inputValue;return J.value?"integer"===e?_xeUtils.default.toInteger((0,_number.handleNumber)(t)):_xeUtils.default.toNumber((0,_number.handleNumber)(t)):0}),Oe=(0,_vue.computed)(function(){var e=W.min,t=z.inputValue,a=J.value,n=Re.value;return!(!t&&0!==t||!a||null===e)&&n<=_xeUtils.default.toNumber(e)}),ze=(0,_vue.computed)(function(){var e=W.max,t=z.inputValue,a=J.value,n=Re.value;return!(!t&&0!==t||!a||null===e)&&n>=_xeUtils.default.toNumber(e)}),He=function(e){var t=W.type,a=W.exponential,n=Fe.value,u=ne.value,u="float"===t?(0,_number.toFloatValueFixed)(e,u):_xeUtils.default.toValueString(e);return!a||e!==u&&_xeUtils.default.toValueString(e).toLowerCase()!==_xeUtils.default.toNumber(u).toExponential()?u.slice(0,n):e},Le=function(e){var t=z.inputValue;$.dispatchEvent(e.type,{value:t},e)},Ge=function(e,t){z.inputValue=e,S("update:modelValue",e),$.dispatchEvent("input",{value:e},t),_xeUtils.default.toValueString(W.modelValue)!==e&&($.dispatchEvent("change",{value:e},t),D&&I&&D.triggerItemEvent(t,I.itemConfig.field,e))},Be=function(e,t){var a=ee.value,n=Ie.value;z.inputValue=e,a||(n?Ge(e,t):$.dispatchEvent("input",{value:e},t))},je=function(e){var t;W.disabled||(t=z.inputValue,$.dispatchEvent("prefix-click",{value:t},e))},Qe=function(){return new Promise(function(e){z.visiblePanel=!1,g=window.setTimeout(function(){z.animatVisible=!1,e()},350)})},$e=function(e){var t;W.disabled||((0,_dom.hasClass)(e.currentTarget,"is--clear")?(Ge("",e),b(e,"")):(t=z.inputValue,$.dispatchEvent("suffix-click",{value:t},e)))},Ze=function(e){var t=W.type,a=W.valueFormat,n=xe.value,u=be.value,l=null,i="";e&&(l=Z(e,a)),_xeUtils.default.isValidDate(l)?(i=_xeUtils.default.toDateString(l,n,{firstDay:u}),n&&"week"===t&&_xeUtils.default.getWhatWeek(l,0,u,u).getFullYear()<l.getFullYear()&&(-1<(n=n.indexOf("yyyy"))&&((n=Number(i.substring(n,n+4)))&&!isNaN(n)&&(i=i.replace("".concat(n),"".concat(n-1)))))):l=null,z.datePanelValue=l,z.datePanelLabel=i},Xe=function(e){return null===W.max||_xeUtils.default.toNumber(e)<=_xeUtils.default.toNumber(W.max)},Je=function(e){return null===W.min||_xeUtils.default.toNumber(e)>=_xeUtils.default.toNumber(W.min)},et=function(){z.inputValue=W.multiple?ve.value:z.datePanelLabel},tt=function(e){e=_xeUtils.default.getWhatMonth(e,0,"first");_xeUtils.default.isEqual(e,z.selectMonth)||(z.selectMonth=e)},at=function(t){var e,a=W.modelValue,n=W.multiple,u=z.datetimePanelValue,l=X.value,i=de.value,r=be.value;"week"===W.type?(e=_xeUtils.default.toNumber(W.selectDay),t=_xeUtils.default.getWhatWeek(t,0,e,r)):l&&(t.setHours(u.getHours()),t.setMinutes(u.getMinutes()),t.setSeconds(u.getSeconds()));var s,o=_xeUtils.default.toDateString(t,i,{firstDay:r});tt(t),n?(n=ce.value,l?(l=oe.value,s=[],l.forEach(function(e){e&&!_xeUtils.default.isDateSame(t,e,"yyyyMMdd")&&(e.setHours(u.getHours()),e.setMinutes(u.getMinutes()),e.setSeconds(u.getSeconds()),s.push(e))}),s.push(t),Ge(s.map(function(e){return _xeUtils.default.toDateString(e,i)}).join(","),{type:"update"})):n.some(function(e){return _xeUtils.default.isEqual(e,o)})?Ge(n.filter(function(e){return!_xeUtils.default.isEqual(e,o)}).join(","),{type:"update"}):Ge(n.concat([o]).join(","),{type:"update"})):_xeUtils.default.isEqual(a,o)||Ge(o,{type:"update"})},nt=function(){var e,t,a=W.type,n=W.min,u=W.max,l=W.exponential,i=z.inputValue,r=z.datetimePanelValue,s=J.value,o=ee.value,c=xe.value;qe.value||(s?i&&(t="integer"===a?_xeUtils.default.toInteger((0,_number.handleNumber)(i)):_xeUtils.default.toNumber((0,_number.handleNumber)(i)),Je(t)?Xe(t)||(t=u):t=n,!l||(e=_xeUtils.default.toValueString(i).toLowerCase())===_xeUtils.default.toNumber(t).toExponential()&&(t=e),Ge(He(t),{type:"check"})):o&&(i?(e=Z(i,c),_xeUtils.default.isValidDate(e)?"time"===a?(i!==(e=_xeUtils.default.toDateString(e,c))&&Ge(e,{type:"check"}),z.inputValue=e):(t=!1,o=be.value,"datetime"===a?(a=fe.value,i===_xeUtils.default.toDateString(a,c)&&i===_xeUtils.default.toDateString(e,c)||(t=!0,r.setHours(e.getHours()),r.setMinutes(e.getMinutes()),r.setSeconds(e.getSeconds()))):t=!0,z.inputValue=_xeUtils.default.toDateString(e,c,{firstDay:o}),t&&at(e)):et()):Ge("",{type:"check"})))},ut=function(e){var t=W.readonly,a=W.disabled,n=Oe.value;clearTimeout(E),a||t||n||l(!1,e),$.dispatchEvent("next-number",{},e)},lt=function(e){var t=W.readonly,a=W.disabled,n=ze.value;clearTimeout(E),a||t||n||l(!0,e),$.dispatchEvent("prev-number",{},e)},it=function(e){var t=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_UP),a=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_DOWN);(t||a)&&(e.preventDefault(),(t?lt:ut)(e))},rt=function(e,t){z.selectMonth=_xeUtils.default.getWhatMonth(e,t,"first")},st=function(){var e=_xeUtils.default.getWhatDay(Date.now(),0,"first");z.currentDate=e,rt(e,0)},ot=function(e){var t=W.type,a=z.datePanelType,n=z.selectMonth;pe.value||(z.selectMonth="year"===t?_xeUtils.default.getWhatYear(n,-yearSize,"first"):"month"===t||"quarter"===t?"year"===a?_xeUtils.default.getWhatYear(n,-yearSize,"first"):_xeUtils.default.getWhatYear(n,-1,"first"):"year"===a?_xeUtils.default.getWhatYear(n,-yearSize,"first"):"month"===a?_xeUtils.default.getWhatYear(n,-1,"first"):_xeUtils.default.getWhatMonth(n,-1,"first"),$.dispatchEvent("date-prev",{type:t},e))},ct=function(e){var t=W.type,a=z.datePanelType,n=z.selectMonth;_e.value||(z.selectMonth="year"===t?_xeUtils.default.getWhatYear(n,yearSize,"first"):"month"===t||"quarter"===t?"year"===a?_xeUtils.default.getWhatYear(n,yearSize,"first"):_xeUtils.default.getWhatYear(n,1,"first"):"year"===a?_xeUtils.default.getWhatYear(n,yearSize,"first"):"month"===a?_xeUtils.default.getWhatYear(n,1,"first"):_xeUtils.default.getWhatMonth(n,1,"first"),$.dispatchEvent("date-next",{type:t},e))},vt=function(t){Y({date:t})||(ke.value.some(function(e){return _xeUtils.default.isDateSame(e.date,t,"yyyyMMdd")})||tt(t),Ze(t))},dt=function(t){Y({date:t})||(ye.value.some(function(e){return _xeUtils.default.isDateSame(e.date,t,"yyyy")})||tt(t),Ze(t))},ft=function(t){Y({date:t})||(Pe.value.some(function(e){return _xeUtils.default.isDateSame(e.date,t,"yyyyq")})||tt(t),Ze(t))},pt=function(t){Y({date:t})||(Ve.value.some(function(e){return _xeUtils.default.isDateSame(e.date,t,"yyyyMM")})||tt(t),Ze(t))},_t=function(e){var t;e&&(t=e.offsetHeight,e.parentNode.scrollTop=e.offsetTop-4*t)},mt=function(){var e=W.disabled,t=z.visiblePanel,a=ee.value;return e||t?(0,_vue.nextTick)():(z.inited||(z.inited=!0),clearTimeout(g),z.isActivated=!0,z.animatVisible=!0,a&&(e=W.type,t=X.value,a=fe.value,-1<["year","quarter","month","week"].indexOf(e)?z.datePanelType=e:z.datePanelType="day",z.currentDate=_xeUtils.default.getWhatDay(Date.now(),0,"first"),a?(rt(a,0),Ze(a)):st(),t&&(z.datetimePanelValue=z.datePanelValue||_xeUtils.default.getWhatDay(Date.now(),0,"first"),(0,_vue.nextTick)(function(){var e=B.value;_xeUtils.default.arrayEach(e.querySelectorAll("li.is--selected"),_t)}))),setTimeout(function(){z.visiblePanel=!0},10),z.panelIndex<(0,_utils.getLastZIndex)()&&(z.panelIndex=(0,_utils.nextZIndex)()),p())},ht=function(e){W.readonly||(e.preventDefault(),mt())},xt=function(){var e=W.multiple,t=z.datePanelType,a=pe.value,n=_e.value,u=ge.value;return[(0,_vue.h)("div",{class:"vxe-input--date-picker-header"},[(0,_vue.h)("div",{class:"vxe-input--date-picker-type-wrapper"},["year"===t?(0,_vue.h)("span",{class:"vxe-input--date-picker-label"},u):(0,_vue.h)("span",{class:"vxe-input--date-picker-btn",onClick:c},u)]),(0,_vue.h)("div",{class:"vxe-input--date-picker-btn-wrapper"},[(0,_vue.h)("span",{class:["vxe-input--date-picker-btn vxe-input--date-picker-prev-btn",{"is--disabled":a}],onClick:ot},[(0,_vue.h)("i",{class:"vxe-icon-caret-left"})]),(0,_vue.h)("span",{class:"vxe-input--date-picker-btn vxe-input--date-picker-current-btn",onClick:v},[(0,_vue.h)("i",{class:"vxe-icon-dot"})]),(0,_vue.h)("span",{class:["vxe-input--date-picker-btn vxe-input--date-picker-next-btn",{"is--disabled":n}],onClick:ct},[(0,_vue.h)("i",{class:"vxe-icon-caret-right"})]),e&&se.value?(0,_vue.h)("span",{class:"vxe-input--date-picker-btn vxe-input--date-picker-confirm-btn"},[(0,_vue.h)("button",{class:"vxe-input--date-picker-confirm",type:"button",onClick:f},_conf.default.i18n("vxe.button.confirm"))]):null])]),(0,_vue.h)("div",{class:"vxe-input--date-picker-body"},y())]},yt=function(){var a=z.datetimePanelValue,e=me.value,t=We.value,n=Ye.value,u=Ce.value;return[(0,_vue.h)("div",{class:"vxe-input--time-picker-header"},[(0,_vue.h)("span",{class:"vxe-input--time-picker-title"},e),(0,_vue.h)("button",{class:"vxe-input--time-picker-confirm",type:"button",onClick:f},_conf.default.i18n("vxe.button.confirm"))]),(0,_vue.h)("div",{ref:B,class:"vxe-input--time-picker-body"},[(0,_vue.h)("ul",{class:"vxe-input--time-picker-hour-list"},t.map(function(t,e){return(0,_vue.h)("li",{key:e,class:{"is--selected":a&&a.getHours()===t.value},onClick:function(e){return e=e,z.datetimePanelValue.setHours(t.value),void d(e)}},t.label)})),(0,_vue.h)("ul",{class:"vxe-input--time-picker-minute-list"},n.map(function(t,e){return(0,_vue.h)("li",{key:e,class:{"is--selected":a&&a.getMinutes()===t.value},onClick:function(e){return e=e,z.datetimePanelValue.setMinutes(t.value),void d(e)}},t.label)})),(0,_vue.h)("ul",{class:"vxe-input--time-picker-second-list"},u.map(function(t,e){return(0,_vue.h)("li",{key:e,class:{"is--selected":a&&a.getSeconds()===t.value},onClick:function(e){return e=e,z.datetimePanelValue.setSeconds(t.value),void d(e)}},t.label)}))])]},gt=function(){var e=ze.value,t=Oe.value;return(0,_vue.h)("span",{class:"vxe-input--number-suffix"},[(0,_vue.h)("span",{class:["vxe-input--number-prev is--prev",{"is--disabled":e}],onMousedown:o,onMouseup:r,onMouseleave:r},[(0,_vue.h)("i",{class:["vxe-input--number-prev-icon",_conf.default.icon.INPUT_PREV_NUM]})]),(0,_vue.h)("span",{class:["vxe-input--number-next is--next",{"is--disabled":t}],onMousedown:o,onMouseup:r,onMouseleave:r},[(0,_vue.h)("i",{class:["vxe-input--number-next-icon",_conf.default.icon.INPUT_NEXT_NUM]})])])},bt=function(){return(0,_vue.h)("span",{class:"vxe-input--date-picker-suffix",onClick:ht},[(0,_vue.h)("i",{class:["vxe-input--date-picker-icon",_conf.default.icon.INPUT_DATE]})])},Ut=function(){return(0,_vue.h)("span",{class:"vxe-input--search-suffix",onClick:n},[(0,_vue.h)("i",{class:["vxe-input--search-icon",_conf.default.icon.INPUT_SEARCH]})])},Et=function(){var e=z.showPwd;return(0,_vue.h)("span",{class:"vxe-input--password-suffix",onClick:a},[(0,_vue.h)("i",{class:["vxe-input--password-icon",e?_conf.default.icon.INPUT_SHOW_PWD:_conf.default.icon.INPUT_PWD]})])},$={dispatchEvent:function(e,t,a){S(e,Object.assign({$input:Q,$event:a},t))},focus:function(){var e=L.value;return z.isActivated=!0,e.focus(),(0,_vue.nextTick)()},blur:function(){return L.value.blur(),(z.isActivated=!1,_vue.nextTick)()},showPanel:mt,hidePanel:Qe,updatePlacement:p};Object.assign(Q,$),(0,_vue.watch)(function(){return W.modelValue},function(e){z.inputValue=e,u()}),(0,_vue.watch)(function(){return W.type},function(){Object.assign(z,{inputValue:W.modelValue,datetimePanelValue:null,datePanelValue:null,datePanelLabel:"",datePanelType:"day",selectMonth:null,currentDate:null}),t()}),(0,_vue.watch)(xe,function(){ee.value&&(Ze(z.datePanelValue),z.inputValue=W.multiple?ve.value:z.datePanelLabel)}),(0,_vue.nextTick)(function(){_event.GlobalEvent.on(Q,"mousewheel",h),_event.GlobalEvent.on(Q,"mousedown",_),_event.GlobalEvent.on(Q,"keydown",m),_event.GlobalEvent.on(Q,"blur",x)}),(0,_vue.onUnmounted)(function(){r(),_event.GlobalEvent.off(Q,"mousewheel"),_event.GlobalEvent.off(Q,"mousedown"),_event.GlobalEvent.off(Q,"keydown"),_event.GlobalEvent.off(Q,"blur")}),t();return Q.renderVN=function(){var e,t,a,n,u,l,i,r=W.className,s=W.controls,o=W.type,c=W.align,v=W.name,d=W.disabled,f=W.readonly,p=W.autocomplete,_=z.inputValue,m=z.visiblePanel,h=z.isActivated,x=O.value,y=ee.value,g=qe.value,b=Fe.value,U=Ke.value,E=Ae.value,S=[],D=(u=W.prefixIcon,n=F.prefix,l=[],n?l.push((0,_vue.h)("span",{class:"vxe-input--prefix-icon"},n({}))):u&&l.push((0,_vue.h)("i",{class:["vxe-input--prefix-icon",u]})),l.length?(0,_vue.h)("span",{class:"vxe-input--prefix",onClick:je},l):null),l=(e=W.disabled,t=W.suffixIcon,a=z.inputValue,n=F.suffix,u=le.value,l=[],n?l.push((0,_vue.h)("span",{class:"vxe-input--suffix-icon"},n({}))):t&&l.push((0,_vue.h)("i",{class:["vxe-input--suffix-icon",t]})),u&&l.push((0,_vue.h)("i",{class:["vxe-input--clear-icon",_conf.default.icon.INPUT_CLEAR]})),l.length?(0,_vue.h)("span",{class:["vxe-input--suffix",{"is--clear":u&&!e&&!(""===a||_xeUtils.default.eqNull(a))}],onClick:$e},l):null);return D&&S.push(D),S.push((0,_vue.h)("input",{ref:L,class:"vxe-input--inner",value:_,name:v,type:U,placeholder:E,maxlength:b,readonly:g,disabled:d,autocomplete:p,onKeydown:k,onKeyup:T,onWheel:M,onClick:K,onInput:P,onChange:N,onFocus:V,onBlur:w})),l&&S.push(l),S.push((_=W.controls,v=J.value,U=ee.value,E=te.value,b=ae.value,E?i=Et():v?_&&(i=gt()):U?i=bt():b&&(i=Ut()),i?(0,_vue.h)("span",{class:"vxe-input--extra-suffix"},[i]):null)),y&&S.push((g=W.type,p=W.transfer,E=z.inited,v=z.animatVisible,_=z.visiblePanel,U=z.panelPlacement,b=z.panelStyle,i=O.value,y=[],ee.value?("datetime"===g?y.push((0,_vue.h)("div",{class:"vxe-input--panel-layout-wrapper"},[(0,_vue.h)("div",{class:"vxe-input--panel-left-wrapper"},xt()),(0,_vue.h)("div",{class:"vxe-input--panel-right-wrapper"},yt())])):"time"===g?y.push((0,_vue.h)("div",{class:"vxe-input--panel-wrapper"},yt())):y.push((0,_vue.h)("div",{class:"vxe-input--panel-wrapper"},xt())),(0,_vue.h)(_vue.Teleport,{to:"body",disabled:!p||!E},[(0,_vue.h)("div",{ref:G,class:["vxe-table--ignore-clear vxe-input--panel","type--".concat(g),((g={})["size--".concat(i)]=i,g["is--transfer"]=p,g["animat--leave"]=v,g["animat--enter"]=_,g)],placement:U,style:b},y)])):null)),(0,_vue.h)("div",{ref:H,class:["vxe-input","type--".concat(o),r,((r={})["size--".concat(x)]=x,r["is--".concat(c)]=c,r["is--controls"]=s,r["is--prefix"]=!!D,r["is--suffix"]=!!l,r["is--readonly"]=f,r["is--visivle"]=m,r["is--disabled"]=d,r["is--active"]=h,r)]},S)},Q},render:function(){return this.renderVN()}});exports.default=_default2;