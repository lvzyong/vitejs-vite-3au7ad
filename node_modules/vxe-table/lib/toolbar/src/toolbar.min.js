"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_vXETable=require("../../v-x-e-table"),_size=require("../../hooks/size"),_dom=require("../../tools/dom"),_utils=require("../../tools/utils"),_log=require("../../tools/log"),_event=require("../../tools/event"),_vn=require("../../tools/vn");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var i in t=arguments[o])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},_default2=(0,_vue.defineComponent)({name:"VxeToolbar",props:{loading:Boolean,refresh:[Boolean,Object],import:[Boolean,Object],export:[Boolean,Object],print:[Boolean,Object],zoom:[Boolean,Object],custom:[Boolean,Object],buttons:{type:Array,default:function(){return _conf.default.toolbar.buttons}},tools:{type:Array,default:function(){return _conf.default.toolbar.tools}},perfect:{type:Boolean,default:function(){return _conf.default.toolbar.perfect}},size:{type:String,default:function(){return _conf.default.toolbar.size||_conf.default.size}},className:[String,Function]},emits:["button-click","tool-click"],setup:function(f,e){function n(){var e=g.columns,t=h.getComputeMaps().computeCustomOpts.value.checkMethod;E.isAll=e.every(function(e){return!!t&&!t({column:e})||e.visible}),E.isIndeterminate=!E.isAll&&e.some(function(e){return(!t||t({column:e}))&&(e.visible||e.halfVisible)})}function i(){h.handleCustom()}function t(e){v()&&(E.visible||(E.visible=!0,n(),q("open",e)))}function o(e){E.visible&&(V(),q("close",e))}function r(t){var e=g.columns;(e=_xeUtils.default.findTree(e,function(e){return e===t}))&&e.parent&&((e=e.parent).children&&e.children.length&&(e.visible=e.children.every(function(e){return e.visible}),e.halfVisible=!e.visible&&e.children.some(function(e){return e.visible||e.halfVisible}),r(e)))}function u(e){var t=T.value;(0,_dom.getEventTargetNode)(e,t).flag||o(e)}function l(e){o(e)}function d(){var e=g.isRefresh,t=R.value;if(!e){e=t.queryMethod||t.query;if(e){g.isRefresh=!0;try{Promise.resolve(e({})).catch(function(e){return e}).then(function(){g.isRefresh=!1})}catch(e){g.isRefresh=!1}}else y&&(g.isRefresh=!0,y.commitProxy(t.code||"reload").catch(function(e){return e}).then(function(){g.isRefresh=!1}))}}function _(e){y&&y.triggerZoomEvent(e)}function b(){v()&&h.openImport()}function m(){v()&&h.openExport()}function p(){v()&&h.openPrint()}var h,x=e.slots,c=e.emit,a=_xeUtils.default.uniqueId(),O=(0,_size.useSize)(f),g=(0,_vue.reactive)({isRefresh:!1,columns:[]}),C=(0,_vue.ref)(),T=(0,_vue.ref)(),E=(0,_vue.reactive)({isAll:!1,isIndeterminate:!1,activeBtn:!1,activeWrapper:!1,visible:!1}),s={refElem:C},B={xID:a,props:f,context:e,reactData:g,getRefMaps:function(){return s}},e={},y=(0,_vue.inject)("$xegrid",null),R=(0,_vue.computed)(function(){return Object.assign({},_conf.default.toolbar.refresh,f.refresh)}),k=(0,_vue.computed)(function(){return Object.assign({},_conf.default.toolbar.import,f.import)}),L=(0,_vue.computed)(function(){return Object.assign({},_conf.default.toolbar.export,f.export)}),M=(0,_vue.computed)(function(){return Object.assign({},_conf.default.toolbar.print,f.print)}),A=(0,_vue.computed)(function(){return Object.assign({},_conf.default.toolbar.zoom,f.zoom)}),N=(0,_vue.computed)(function(){return Object.assign({},_conf.default.toolbar.custom,f.custom)}),v=function(){if(h)return!0;(0,_log.errLog)("vxe.error.barUnableLink")},V=function(){var e=f.custom,t=N.value;E.visible&&(E.visible=!1,e&&!t.immediate&&i())},q=function(e,t){(y||h).dispatchEvent("custom",{type:e},t)},j=function(e){V(),q("confirm",e)},I=function(e){var t=g.columns,o=h.getComputeMaps().computeCustomOpts.value.checkMethod;_xeUtils.default.eachTree(t,function(e){o&&!o({column:e})||(e.visible=e.defaultVisible,e.halfVisible=!1),e.resizeWidth=0}),h.saveCustomResizable(!0),V(),q("reset",e)},z=function(e){var t=!e.visible,o=N.value;_xeUtils.default.eachTree([e],function(e){e.visible=t,e.halfVisible=!1}),r(e),f.custom&&o.immediate&&i(),n()},S=function(){var e=g.columns,t=h.getComputeMaps().computeCustomOpts.value.checkMethod,o=!E.isAll;_xeUtils.default.eachTree(e,function(e){t&&!t({column:e})||(e.visible=o,e.halfVisible=!1)}),E.isAll=o,n()},$=function(e){(E.visible?o:t)(e)},X=function(e){E.activeBtn=!0,t(e)},U=function(e){E.activeBtn=!1,setTimeout(function(){E.activeBtn||E.activeWrapper||o(e)},300)},w=function(e){E.activeWrapper=!0,t(e)},D=function(e){E.activeWrapper=!1,setTimeout(function(){E.activeBtn||E.activeWrapper||o(e)},300)},H=function(e,t){var o,n=t.code;n&&(y?y.triggerToolbarBtnEvent(t,e):(o=_vXETable.VXETable.commands.get(n),t={code:n,button:t,$table:h,$event:e},o&&o(t,e),B.dispatchEvent("button-click",t,e)))},K=function(e,t){var o,n=t.code;n&&(y?y.triggerToolbarTolEvent(t,e):(o=_vXETable.VXETable.commands.get(n),t={code:n,tool:t,$table:h,$event:e},o&&o(t,e),B.dispatchEvent("tool-click",t,e)))},P=function(e,o){e=e.dropdowns;return e?e.map(function(t,e){return!1===t.visible?(0,_vue.createCommentVNode)():(0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),{key:e,disabled:t.disabled,loading:t.loading,type:t.type,icon:t.icon,circle:t.circle,round:t.round,status:t.status,content:t.name,onClick:function(e){return(o?H:K)(e,t)}})}):[]},e={dispatchEvent:function(e,t,o){c(e,Object.assign({$toolbar:B,$event:o},t))},syncUpdate:function(e){var t=e.collectColumn;h=e.$table,g.columns=t}};Object.assign(B,e),(0,_vue.onMounted)(function(){_event.GlobalEvent.on(B,"mousedown",u),_event.GlobalEvent.on(B,"blur",l)}),(0,_vue.onUnmounted)(function(){_event.GlobalEvent.off(B,"mousedown"),_event.GlobalEvent.off(B,"blur")}),(0,_vue.nextTick)(function(){var e=f.refresh,t=R.value,t=t.queryMethod||t.query;!e||y||t||(0,_log.warnLog)("vxe.error.notFunc",["queryMethod"])});return B.renderVN=function(){var e=f.perfect,t=f.loading,o=f.refresh,n=f.zoom,i=f.custom,r=f.className,u=O.value,l=R.value,c=k.value,a=L.value,s=M.value,v=A.value;return(0,_vue.h)("div",{ref:C,class:["vxe-toolbar",r?_xeUtils.default.isFunction(r)?r({$toolbar:B}):r:"",((r={})["size--".concat(u)]=u,r["is--perfect"]=e,r["is--loading"]=t,r)]},[(0,_vue.h)("div",{class:"vxe-buttons--wrapper"},function(){var e=f.buttons,t=x.buttons;if(t)return(0,_vn.getSlotVNs)(t({$grid:y,$table:h}));var i=[];return e&&e.forEach(function(t){var e,o=t.dropdowns,n=t.buttonRender;!1!==t.visible&&(e=n?_vXETable.VXETable.renderer.get(n.name):null,n&&e&&e.renderToolbarButton?i.push((0,_vue.h)("span",{class:"vxe-button--item"},e.renderToolbarButton(n,{$grid:y,$table:h,button:t}))):i.push((0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),{disabled:t.disabled,loading:t.loading,type:t.type,icon:t.icon,circle:t.circle,round:t.round,status:t.status,content:t.name,destroyOnClose:t.destroyOnClose,placement:t.placement,transfer:t.transfer,onClick:function(e){return H(e,t)}},o&&o.length?{dropdowns:function(){return P(t,!0)}}:{})))}),i}()),(0,_vue.h)("div",{class:"vxe-tools--wrapper"},function(){var e=f.tools,t=x.tools;if(t)return(0,_vn.getSlotVNs)(t({$grid:y,$table:h}));var i=[];return e&&e.forEach(function(t){var e,o=t.dropdowns,n=t.toolRender;!1!==t.visible&&(e=n?_vXETable.VXETable.renderer.get(n.name):null,n&&e&&e.renderToolbarTool?i.push((0,_vue.h)("span",{class:"vxe-tool--item"},e.renderToolbarTool(n,{$grid:y,$table:h,tool:t}))):i.push((0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),{disabled:t.disabled,loading:t.loading,type:t.type,icon:t.icon,circle:t.circle,round:t.round,status:t.status,content:t.name,destroyOnClose:t.destroyOnClose,placement:t.placement,transfer:t.transfer,onClick:function(e){return K(e,t)}},o&&o.length?{dropdowns:function(){return P(t,!1)}}:{})))}),i}()),(0,_vue.h)("div",{class:"vxe-tools--operate"},[f.import?(0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),{circle:!0,icon:c.icon||_conf.default.icon.TOOLBAR_TOOLS_IMPORT,title:_conf.default.i18n("vxe.toolbar.import"),onClick:b}):(0,_vue.createCommentVNode)(),f.export?(0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),{circle:!0,icon:a.icon||_conf.default.icon.TOOLBAR_TOOLS_EXPORT,title:_conf.default.i18n("vxe.toolbar.export"),onClick:m}):(0,_vue.createCommentVNode)(),f.print?(0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),{circle:!0,icon:s.icon||_conf.default.icon.TOOLBAR_TOOLS_PRINT,title:_conf.default.i18n("vxe.toolbar.print"),onClick:p}):(0,_vue.createCommentVNode)(),o?(0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),{circle:!0,icon:g.isRefresh?l.iconLoading||_conf.default.icon.TOOLBAR_TOOLS_REFRESH_LOADING:l.icon||_conf.default.icon.TOOLBAR_TOOLS_REFRESH,title:_conf.default.i18n("vxe.toolbar.refresh"),onClick:d}):(0,_vue.createCommentVNode)(),n&&y?(0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),{circle:!0,icon:y.isMaximized()?v.iconOut||_conf.default.icon.TOOLBAR_TOOLS_MINIMIZE:v.iconIn||_conf.default.icon.TOOLBAR_TOOLS_FULLSCREEN,title:_conf.default.i18n("vxe.toolbar.zoom".concat(y.isMaximized()?"Out":"In")),onClick:_}):(0,_vue.createCommentVNode)(),(i?function(){var u,e=g.columns,t=N.value,l=[],o={},n={};h&&(u=h.getComputeMaps().computeCustomOpts.value.checkMethod),"manual"===t.trigger||("hover"===t.trigger?(o.onMouseenter=X,o.onMouseleave=U,n.onMouseenter=w,n.onMouseleave=D):o.onClick=$),_xeUtils.default.eachTree(e,function(e){var t,o=(0,_utils.formatText)(e.getTitle(),1),n=e.getKey(),i=e.children&&e.children.length,r=!!u&&!u({column:e});(i||n)&&(t=e.visible,n=e.halfVisible,l.push((0,_vue.h)("li",{class:["vxe-custom--option","level--".concat(e.level),{"is--group":i,"is--checked":t,"is--indeterminate":n,"is--disabled":r}],title:o,onClick:function(){r||z(e)}},[(0,_vue.h)("span",{class:["vxe-checkbox--icon",n?_conf.default.icon.TABLE_CHECKBOX_INDETERMINATE:t?_conf.default.icon.TABLE_CHECKBOX_CHECKED:_conf.default.icon.TABLE_CHECKBOX_UNCHECKED]}),(0,_vue.h)("span",{class:"vxe-checkbox--label"},o)])))});var i=E.isAll,e=E.isIndeterminate;return(0,_vue.h)("div",{class:["vxe-custom--wrapper",{"is--active":E.visible}],ref:T},[(0,_vue.h)((0,_vue.resolveComponent)("vxe-button"),__assign({circle:!0,icon:t.icon||_conf.default.icon.TOOLBAR_TOOLS_CUSTOM,title:_conf.default.i18n("vxe.toolbar.custom")},o)),(0,_vue.h)("div",{class:"vxe-custom--option-wrapper"},[(0,_vue.h)("ul",{class:"vxe-custom--header"},[(0,_vue.h)("li",{class:["vxe-custom--option",{"is--checked":i,"is--indeterminate":e}],title:_conf.default.i18n("vxe.table.allTitle"),onClick:S},[(0,_vue.h)("span",{class:["vxe-checkbox--icon",e?_conf.default.icon.TABLE_CHECKBOX_INDETERMINATE:i?_conf.default.icon.TABLE_CHECKBOX_CHECKED:_conf.default.icon.TABLE_CHECKBOX_UNCHECKED]}),(0,_vue.h)("span",{class:"vxe-checkbox--label"},_conf.default.i18n("vxe.toolbar.customAll"))])]),(0,_vue.h)("ul",__assign({class:"vxe-custom--body"},n),l),!1===t.isFooter?null:(0,_vue.h)("div",{class:"vxe-custom--footer"},[(0,_vue.h)("button",{class:"btn--confirm",onClick:j},_conf.default.i18n("vxe.toolbar.customConfirm")),(0,_vue.h)("button",{class:"btn--reset",onClick:I},_conf.default.i18n("vxe.toolbar.customRestore"))])])])}:(0,_vue.createCommentVNode))()])])},B},render:function(){return this.renderVN()}});exports.default=_default2;