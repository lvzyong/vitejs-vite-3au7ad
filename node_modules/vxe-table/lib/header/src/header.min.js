"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_util=require("./util"),_util2=require("../../table/src/util"),_dom=require("../../tools/dom");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,l=1,n=arguments.length;l<n;l++)for(var r in t=arguments[l])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},renderType="header",_default=(0,_vue.defineComponent)({name:"VxeTableHeader",props:{tableData:Array,tableColumn:Array,tableGroupColumn:Array,fixedColumn:Array,fixedType:{type:String,default:null}},setup:function(U){function l(){var e=s.isGroup;d.value=e?(0,_util.convertToRows)(U.tableGroupColumn):[]}var k=(0,_vue.inject)("$xetable",{}),i=k.xID,u=k.props,s=k.reactData,I=k.internalData,e=k.getRefMaps(),$=e.refElem,H=e.refTableBody,O=e.refLeftContainer,q=e.refRightContainer,A=e.refCellResizeBar,c=k.getComputeMaps().computeColumnOpts,d=(0,_vue.ref)([]),E=(0,_vue.ref)(),f=(0,_vue.ref)(),p=(0,_vue.ref)(),v=(0,_vue.ref)(),m=(0,_vue.ref)(),_=(0,_vue.ref)();(0,_vue.watch)(function(){return U.tableColumn},l),(0,_vue.onMounted)(function(){(0,_vue.nextTick)(function(){var e=U.fixedType,t=k.internalData.elemStore,e="".concat(e||"main","-header-");t["".concat(e,"wrapper")]=E,t["".concat(e,"table")]=f,t["".concat(e,"colgroup")]=p,t["".concat(e,"list")]=v,t["".concat(e,"xSpace")]=m,t["".concat(e,"repair")]=_,l()})}),(0,_vue.onUnmounted)(function(){var e=U.fixedType,t=k.internalData.elemStore,e="".concat(e||"main","-header-");t["".concat(e,"wrapper")]=null,t["".concat(e,"table")]=null,t["".concat(e,"colgroup")]=null,t["".concat(e,"list")]=null,t["".concat(e,"xSpace")]=null,t["".concat(e,"repair")]=null});return function(){var h=U.fixedType,e=U.fixedColumn,t=U.tableColumn,x=u.resizable,g=u.border,b=u.columnKey,l=u.headerRowClassName,y=u.headerCellClassName,n=u.headerRowStyle,C=u.headerCellStyle,w=u.showHeaderOverflow,M=u.headerAlign,z=u.align,T=u.mouseConfig,r=s.isGroup,S=s.currentColumn,D=s.scrollXLoad,R=s.overflowX,a=s.scrollbarWidth,W=c.value,o=d.value;return r||(o=[t=h&&(D||w)?e:t]),(0,_vue.h)("div",{ref:E,class:["vxe-table--header-wrapper",h?"fixed-".concat(h,"--wrapper"):"body--wrapper"],xid:i},[h?(0,_vue.createCommentVNode)():(0,_vue.h)("div",{ref:m,class:"vxe-body--x-space"}),(0,_vue.h)("table",{ref:f,class:"vxe-table--header",xid:i,cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("colgroup",{ref:p},t.map(function(e,t){return(0,_vue.h)("col",{name:e.id,key:t})}).concat(a?[(0,_vue.h)("col",{name:"col_gutter"})]:[])),(0,_vue.h)("thead",{ref:v},o.map(function(m,_){return(0,_vue.h)("tr",{class:["vxe-header--row",l?_xeUtils.default.isFunction(l)?l({$table:k,$rowIndex:_,fixed:h,type:renderType}):l:""],style:n?_xeUtils.default.isFunction(n)?n({$table:k,$rowIndex:_,fixed:h,type:renderType}):n:null},m.map(function(e,t){var l=e.type,n=e.showHeaderOverflow,r=e.headerAlign,a=e.align,o=e.headerClassName,i=e.children&&e.children.length,u=h?e.fixed!==h&&!i:!!e.fixed&&R,s=_xeUtils.default.isUndefined(n)||_xeUtils.default.isNull(n)?w:n,c=r||a||M||z,d="ellipsis"===s,f="title"===s,p=!0===s||"tooltip"===s,n=f||p||d,r=e.filters&&e.filters.some(function(e){return e.checked}),a=k.getColumnIndex(e),s=k.getVTColumnIndex(e),v={$table:k,$rowIndex:_,column:e,columnIndex:a,$columnIndex:t,_columnIndex:s,fixed:h,type:renderType,isHidden:u,hasFilter:r},a={onClick:function(e){return k.triggerHeaderCellClickEvent(e,v)},onDblclick:function(e){return k.triggerHeaderCellDblclickEvent(e,v)}};return D&&!n&&(d=n=!0),T&&(a.onMousedown=function(e){return k.triggerHeaderCellMousedownEvent(e,v)}),(0,_vue.h)("th",__assign(__assign({class:["vxe-header--column",e.id,((s={})["col--".concat(c)]=c,s["col--".concat(l)]=l,s["col--last"]=t===m.length-1,s["col--fixed"]=e.fixed,s["col--group"]=i,s["col--ellipsis"]=n,s["fixed--hidden"]=u,s["is--sortable"]=e.sortable,s["col--filter"]=!!e.filters,s["is--filter-active"]=r,s["col--current"]=S===e,s),o?_xeUtils.default.isFunction(o)?o(v):o:"",y?_xeUtils.default.isFunction(y)?y(v):y:""],colid:e.id,colspan:1<e.colSpan?e.colSpan:null,rowspan:1<e.rowSpan?e.rowSpan:null,style:C?_xeUtils.default.isFunction(C)?C(v):C:null},a),{key:b||W.useKey||i?e.id:t}),[(0,_vue.h)("div",{class:["vxe-cell",{"c--title":f,"c--tooltip":p,"c--ellipsis":d}]},e.renderHeader(v)),u||i||!(_xeUtils.default.isBoolean(e.resizable)?e.resizable:W.resizable||x)?null:(0,_vue.h)("div",{class:["vxe-resizable",{"is--line":!g||"none"===g}],onMousedown:function(e){return function(e,l){var n=l.column,r=U.fixedType,t=H.value,a=O.value,o=q.value,i=A.value,u=e.clientX,s=E.value,c=e.target,d=l.cell=c.parentNode,f=0,p=t.$el,t=(0,_dom.getOffsetPos)(c,s),s=c.clientWidth,c=Math.floor(s/2),v=(0,_util2.getColMinWidth)(l)-c,m=t.left-d.clientWidth+s+v,_=t.left+c,h=document.onmousemove,x=document.onmouseup,g="left"===r,b="right"===r,y=$.value,C=0;if(g||b){for(var w=g?"nextElementSibling":"previousElementSibling",M=d[w];M&&!(0,_dom.hasClass)(M,"fixed--hidden");)(0,_dom.hasClass)(M,"col--group")||(C+=M.offsetWidth),M=M[w];b&&o&&(_=o.offsetLeft+C)}c=function(e){e.stopPropagation(),e.preventDefault();var t=e.clientX-u,e=_+t,t=r?0:p.scrollLeft;g?e=Math.min(e,(o?o.offsetLeft:p.clientWidth)-C-v):b?(m=(a?a.clientWidth:0)+C+v,e=Math.min(e,_+d.clientWidth-v)):m=Math.max(p.scrollLeft,m),f=Math.max(e,m),i.style.left="".concat(f-t,"px")};I._isResize=!0,(0,_dom.addClass)(y,"drag--resize"),i.style.display="block",document.onmousemove=c,document.onmouseup=function(e){document.onmousemove=h,document.onmouseup=x;var t=n.renderWidth+(b?_-f:f-_);n.resizeWidth=t,i.style.display="none",I._isResize=!1,I._lastResizeTime=Date.now(),k.analyColumnWidth(),k.recalculate(!0).then(function(){k.saveCustomResizable(),k.updateCellAreas(),k.dispatchEvent("resizable-change",__assign(__assign({},l),{resizeWidth:t}),e)}),(0,_dom.removeClass)(y,"drag--resize")},c(e),k.closeMenu&&k.closeMenu()}(e,v)}})])}).concat(a?[(0,_vue.h)("th",{class:"vxe-header--gutter col--gutter"})]:[]))}))]),(0,_vue.h)("div",{ref:_,class:"vxe-table--header-border-line"})])}}});exports.default=_default;